<!doctype html>

<html>
	<head>
		<title>Deforestation</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<meta charset="utf-8">
		
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans">
		<link rel="stylesheet" href="leaflet/leaflet.css" />
		<script src="leaflet/leaflet.js"></script>
		<link rel="stylesheet" href="leaflet/leaflet.fullscreen.css" />
		<script src="leaflet/leaflet.fullscreen.js"></script>
		<script src="leaflet/leaflet.fullscreen.js"></script>
		<script src="highcharts/highcharts.js"></script>
		<script src="highcharts/sankey.js"></script>
		<script src="highcharts/dependency-wheel.js"></script>
		<script src="highcharts/exporting.js"></script>
		<script src="highcharts/export-data.js"></script>
		<script src="highcharts/accessibility.js"></script>
		<!-- for reading GeoTIFF: -->
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://npmcdn.com/geotiff@0.3.6/dist/geotiff.js"></script>
		<script src="https://ihcantabria.github.io/Leaflet.CanvasLayer.Field/dist/leaflet.canvaslayer.field.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.0/chroma.min.js"></script>
		<!-- for the trendline -->
		<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-trendline"></script>
		<style>
			/* Globals */
			html, body {
				height: 100%;
				margin: 0;
				font-family: 'Open Sans', 'OpenSans-Local';
				font-style: normal;
				color: #5D5D5A;
				background-color: #FFF4E3;
			} 			
			p {
				text-align: justify;
				color: #5D5D5A;
			}
			
			/* Leaflet map containers */
			#map, #map_dynamic, #map_2 {
				width: 65%;
				height: 400px;
				margin:  auto;
			}
			
			/* Content section (one revealed at a time) */
			.section {
				padding-left: 250px;
				padding-right: 250px;
				padding-top: 5px;
				padding-bottom: 5px;
			}
			/* Site-wide image section optional options */
			.imagesection {
			}
			/* Site-wide image: text overlay */
			.cim_a_kepen {
				color: white; 
				font-weight: bold; 
				font-size: 15pt;
				text-shadow: 2px 2px 5px #000000c7;
			}
			
			.datawrapper_element {
			  background-color: white;
			  padding-top: 10px;
			  padding-bottom: 10px;
			  padding-left: 30px;
			  padding-right: 30px;
			}
			/* Scroll reveal animation: https://alvarotrigo.com/blog/css-animations-scroll/ */
			.reveal {
			  position: relative;
			  transform: translateY(150px);
			  opacity: 0;
			  transition: 2s all ease;
			}
			.reveal.active{
			  transform: translateY(0);
			  opacity: 1;
			}
			
			/* Top bar container */
			#topbar {
				background-color: #FFF4E3;
				width: 100%;
				top: 0;
				min-height: 75px;
				padding-top: 6px;
				padding-bottom: 6px;
				padding-left: 38px;
				padding-right: 38px;
				display: flex;
				box-sizing: border-box;
			}
			/* Links in topbar */
			#topbar a {
				font-size: 16px;
				text-align: center;
				padding: 10px 10px;
				text-decoration: none;
				border-radius: 3px;
				transition: background-color 0.2s ease-out;
				color: #5D5D5A;
			}
			/* Hover over links in topbar */
			#topbar a:hover {
				background-color: #FFCDAB;
				font-weight: bold;
			}
			
			/* Highcharts */
			.highcharts-data-table table {
				font-family: Verdana, sans-serif;
				border-collapse: collapse;
				border: 1px solid #ebebeb;
				margin: 10px auto;
				text-align: center;
				width: 100%;
				max-width: 500px;
			}
			.highcharts-data-table caption {
				padding: 1em 0;
				font-size: 1.2em;
				color: #555;
			}
			.highcharts-data-table th {
				font-weight: 600;
				padding: 0.5em;
			}
			.highcharts-data-table td,
			.highcharts-data-table th,
			.highcharts-data-table caption {
				padding: 0.5em;
			}
			.highcharts-data-table thead tr,
			.highcharts-data-table tr:nth-child(even) {
				background: #f8f8f8;
			}
			.highcharts-data-table tr:hover {
				background: #f1f7ff;
			}
			#csv {
				display: none;
			}
			
			/* Legends */
			.legend {
				display: flex; 
				flex-direction: row; 
				justify-content: flex-start; 
				grid-column-gap: 10px;
			}
			.legend span {
				position: relative;
				bottom: 3px;
				margin-top: 6px;
			}
			.legendcolumnlist {
				display: flex; 
				flex-direction: column; 
				justify-content: center; 
				grid-row-gap: 1px;
			}
			.legenditem {
				display: flex; 
				flex-direction: row; 
				align-items: center;
			}
			.custom-control {
				background-color: #FFFFFFDD; 
				padding: 6px 8px;
			}
			
			/* Dynamic map: control panel */
			#buttonpanel {
				position: absolute;
				bottom: 5px;
				left: 5px;
				background: rgba(255,255,255,0.4);
				padding: 10px;
				border: solid 2px black;
				border-radius: 5px;
				z-index: 10000;
				text-align: center;
				backdrop-filter: blur(10px);
			}
			
			/* Footer container */
			#footer {
				display: flex;
				bottom: 0px;
				width: 100%;
				justify-content: center;
				column-gap: 50px;
				flex-direction: row;
				height: 90px;
				align-items: center;
				background: rgba(255,255,255,0.4);
				margin-top: 50px;
			}
			
			/* Site-wide image caption (attribution, source, license) */
			.img_wide_caption {
				position: absolute;
				height: 20px; 
				right: 0px;
				margin-top: -29px; 
				padding: 4px 5px 0px 6px;
				color: white;
				font-size: 8pt;
				background: rgba(255,255,255,0.41);
				width: fit-content;
				border-radius: 3px 0px 0px 0px;
				backdrop-filter: blur(2px);
			}
			
			/* Chartjs container width limiter */
			.chartjsdiv {
				max-width: 650px;
				margin: auto;
				width: 45%;
			}
			
			/* Some mobile optimization */
			@media (max-width: 1125px) {
				.section {
					padding-left: 20px; 
					padding-right: 20px;			
				}
				#map, #map_dynamic, #map_2 {
					width: 90%;
					height: 400px;
					margin:  auto;
				}
				p {
					font-size: 12px;
				}
				h2 {
					font-size: 1.2em;
				}
				.cim_a_kepen {
					font-size: 12pt;
				}
			}
			@media (max-width: 790px) {
				h1 {
					font-size: 12pt !important;
				}
				#topbar a {
					font-size: 12px !important;
				}
				.img_wide_caption {
					font-size: 7pt;
				}
			}
			
		</style>
	</head>
	<body>
		
		<div id="topbar">
			<div style="display: flex; flex-direction: column; justify-content: space-between; align-items: center; width: 100%">
				
				<h1 style="font-size: 26px;">A call for multi-disciplinary perspectives to combat deforestation of the Amazon rainforest</h1>
				<div style="display: flex; flex-direction: row; column-gap: 10px; align-items: center;" id="topbar_menubuttons">
					<a href="#section1">Deforestation by states (jump to sc)</a>
					<a href="">somethingelse</a>
					<a href="">linktowhatever</a>
				</div>
			</div>
		</div>
			
		<div id="maincontent" style="display: flex; flex-direction: column; row-gap: 20px;">			
			
			<div id="imagesection1" class="imagesection">
				<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);" class="cim_a_kepen">The Amazon is the largest tropical forest and offers many important ecosystem services, including the sequestration of substantial amounts of carbon, recycling of moisture and supporting biodiversity. Deforestation is one of the major threats that the Amazon is currently facing(Fig 1). Since the early 2000s the rate of deforestation in the Amazon has steadily reduced, but is rising again since ~2018 (Fig 2). Earlier research has shown that deforestation can have a short positive effect on local communities (as expressed by the Human Development Index), but that this effect does not last for long.</div>
				<img src="forest.jpg" style="max-width: 100%"></img>
				<div class="img_wide_caption">Aerial view of the Amazon Rainforest, near Manaus, the capital of the Brazilian state of Amazonas. Author: Neil Palmer (CIAT). Licensed under <a href="https://creativecommons.org/licenses/by-sa/2.0/deed.en">CC BY-SA 2.0</a>.</div>
			</div>
			
			<div id="section0" class="section reveal">
				<h2>States Map</h2>
				<p>The Amazon forest is the largest tropical forest and a hotspot for biodiversity, sequestering large amounts of carbon and regulating moisture transport across the region. Since the early 2000s ,the rate of deforestation in the Amazon has steadily reduced, but is rising again since ~2018, following changes in Brazil’s political leadership. Deforestation is a highly complex process, influenced by both natural processes and societal factors, and uncovering this complexity can inform policy-making to reverse the current trend in deforestation. Based on a review of literature and assessment of satellite observations, climate data and key societal metrics, we highlight important interlinkages and feedbacks related to deforestation. Further, we find large regional differences within the Amazon biome and demonstrate that deforestation in the western part of the Amazon basin is more strongly related to variability in natural drivers (e.g. precipitation) than for the eastern and southern regions. Here we will present our preliminary analysis, which underlies our call for multidisciplinary perspectives and concerted action to combat deforestation in the Amazon forest.</p>
				<div id="map"></div>
			</div>
			
			<div id="section1" class="section reveal">
				<p>The Amazon is the largest tropical forest and offers many important ecosystem services, including the sequestration of substantial amounts of carbon, recycling of moisture and supporting biodiversity. Deforestation is one of the major threats that the Amazon is currently facing(Fig 1). Since the early 2000s the rate of deforestation in the Amazon has steadily reduced, but is rising again since ~2018 (Fig 2). Earlier research has shown that deforestation can have a short positive effect on local communities (as expressed by the Human Development Index), but that this effect does not last for long.</p>
				<div id="map_dynamic"></div>
				<p>blablablablablabla blablablablablabla blablablablablabla blablablablablabl bla blabla bla blablablablablabla blablablablablabla blablablablablabla blablablablablabl bla blabla bla blablablablablabla blablablablablabla blablablablablabla blablablablablabl bla blabla bla blablablablablabla blablablablablabla blablablablablabla blablablablablabl bla blabla bla </p>				
				<div style="display: flex; justify-content: center;"> 
					<div id="container"></div>
				</div>
				<p>
					Chart showing a dependency wheel, where each point consists of multiple
					weighted links to other points. This chart type is often used to
					visualize data flow, and can be a striking way to illustrate
					relationships in data.
				</p>
			</div>
			
			<div id="section2" class="section reveal">
				<h2>Deforestation by states (Legal Amazon)</h2>
				<p>The Amazon is the largest tropical forest and offers many important ecosystem services, including the sequestration of substantial amounts of carbon, recycling of moisture and supporting biodiversity. Deforestation is one of the major threats that the Amazon is currently facing(Fig 1). Since the early 2000s the rate of deforestation in the Amazon has steadily reduced, but is rising again since ~2018 (Fig 2). Earlier research has shown that deforestation can have a short positive effect on local communities (as expressed by the Human Development Index), but that this effect does not last for long.  </p>
				
			</div>
			
			
			<div id="imagesection2" class="imagesection reveal">
				<img src="fire.jpg" style="max-width: 100%"></img>
				<div class="img_wide_caption" style="background-color: red;">CAPTION / ATTRIBUTION NEEDED!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</div>
			</div>
			
			<div id="section3" class="section reveal">
				<h2>What is NIRv?</h2>
				<iframe frameborder="0" class="juxtapose" width="100%" height="863" src="https://cdn.knightlab.com/libs/juxtapose/latest/embed/index.html?uid=9a6c097a-bb5c-11ed-b5bd-6595d9b17862"></iframe>
				
			</div>

			<div id="section4" class="section reveal">
				<p>The Amazon is the largest tropical forest and offers many important ecosystem services, including the sequestration of substantial amounts of carbon, recycling of moisture and supporting biodiversity. Deforestation is one of the major threats that the Amazon is currently facing(Fig 1). Since the early 2000s the rate of deforestation in the Amazon has steadily reduced, but is rising again since ~2018 (Fig 2). Earlier research has shown that deforestation can have a short positive effect on local communities (as expressed by the Human Development Index), but that this effect does not last for long.</p>
				<div style="display: flex; flex-direction; row;">
					<div class="chartjsdiv">
						<canvas id="dualaxisChart" width="100%" height="400px"></canvas>
					</div>
					<div class="chartjsdiv">
						<canvas id="dualaxisChart2" width="100%" height="400px"></canvas>
					</div>
				</div>
				<p>The Amazon is the largest tropical forest and offers many important ecosystem services, including the sequestration of substantial amounts of carbon, recycling of moisture and supporting biodiversity. Deforestation is one of the major threats that the Amazon is currently facing(Fig 1). Since the early 2000s the rate of deforestation in the Amazon has steadily reduced, but is rising again since ~2018 (Fig 2). Earlier research has shown that deforestation can have a short positive effect on local communities (as expressed by the Human Development Index), but that this effect does not last for long.</p>
				<div style="display: flex; flex-direction; row;">
					<div class="chartjsdiv">
						<canvas id="dualaxisChart3" width="100%" height="400px"></canvas>
					</div>
					<div class="chartjsdiv">
						<canvas id="dualaxisChart4" width="100%" height="400px"></canvas>
					</div>
				</div>
				<div class="chartjsdiv">
					<canvas id="scatterplot" width="100%" height="400px"></canvas>
				</div>
				
		</div>
		
		<div id="section5" class="section reveal">

			<div id="map_2"></div>
			
		</div>
				
		<div id="footer">
			<div>footer text (copyright, year, data refs, anything) on the left</div>
			<div>Icon1</div>
			<div>Icon2</div>
			<div>Icon3</div>
		</div>
		
		
		<script>
			// Scroll reveal animation: https://alvarotrigo.com/blog/css-animations-scroll/
			function reveal() {
			  var reveals = document.querySelectorAll(".reveal");
			  for (var i = 0; i < reveals.length; i++) {
				var windowHeight = window.innerHeight;
				var elementTop = reveals[i].getBoundingClientRect().top;
				var elementVisible = 10;
				if (elementTop < windowHeight - elementVisible) {
				  reveals[i].classList.add("active");
				} else {
				  reveals[i].classList.remove("active");
				}
			  }
			}
			
			window.addEventListener("scroll", reveal);

			// To check the scroll position on page load
			reveal();
			
			function areatokm2(value) {
				result = value/1000000
				return result
			}
			
			function tooltip_deforestation(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>Deforestation: " + layer.feature.properties.deforestation_average_deforestation_average.toFixed(2) + " %</div>";
			}
			function tooltip_nirv(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>NIRv: " + layer.feature.properties.nirv_average_Average.toFixed(3) + "</div>";
			}
			function tooltip_precip(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>Precipitation: " + layer.feature.properties.precip_by_states_2001_2019_VAL.toFixed(3) + "</div>";
			}
			function tooltip_population(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>Population density: " + layer.feature.properties.population_average_population_average.toLocaleString() + " / km<sup>2</sup></div>";
			}
			function tooltip_gdp(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>GDP (R$ 1 billion): " + layer.feature.properties.gdp_average_gdp_average + "</div>";
			}		
			
			function stilus_deforestation(feature){
				var p = feature.properties;
				
				if (p.deforestation_average_deforestation_average > 8.0900) {
					return {
						fillColor: '#a50f15'
					}
				} else if (p.deforestation_average_deforestation_average > 5.9100){
					return {
						fillColor: '#de2d26'
					};
				} else if (p.deforestation_average_deforestation_average > 2.4000){
					return {
						fillColor: '#fb6a4a'
					};
				} else if (p.deforestation_average_deforestation_average > 0.6701){
					return {
						fillColor: '#fc9272'
					};
				} else {
					return {
						fillColor: '#fcbba1'
					};
				}
			} 
			
			function stilus_nirv(feature){
				var p = feature.properties;
				
				if (p.nirv_average_Average > 0.24327) {
					return {
						fillColor: '#000c00'
					}
				} else if (p.nirv_average_Average > 0.22448){
					return {
						fillColor: '#004000'
					};
				} else if (p.nirv_average_Average > 0.20270){
					return {
						fillColor: '#008000'
					};
				} else if (p.nirv_average_Average > 0.15989){
					return {
						fillColor: '#7fbf7f'
					};
				} else {
					return {
						fillColor: '#e5f2e5'
					};
				}
			}
			
			function stilus_precip(feature){
				var p = feature.properties;
				
				if (p.precip_by_states_2001_2019_VAL > 7.0007) {
					return {
						color: '#beeb1d'
					}
				} else if (p.precip_by_states_2001_2019_VAL > 5.0864){
					return {
						color: '#d1ff00'
					};
				} else if (p.precip_by_states_2001_2019_VAL > 4.0013){
					return {
						color: '#d9ff00'
					};
				} else if (p.precip_by_states_2001_2019_VAL > 3.2645){
					return {
						color: '#f6f43e'
					};
				} else {
					return {
						color: '#feff63'
					};
				}
			}
			
			function stilus_population(feature){
				var p = feature.properties;
				
				if (p.population_average_population_average > 6.180) {
					return {
						fillColor: '#a63603'
					}
				} else if (p.population_average_population_average > 4.790){
					return {
						fillColor: '#e6550d'
					};
				} else if (p.population_average_population_average > 3.210){
					return {
						fillColor: '#fd8d3c'
					};
				} else if (p.population_average_population_average > 1.911){
					return {
						fillColor: '#fdbe85'
					};
				} else {
					return {
						fillColor: '#feedde'
					};
				}
			}
			
			function stilus_gdp(feature){
				var p = feature.properties;
				
				if (p.gdp_average_gdp_average > 98.75) {
					return {
						fillColor: '#54278f'
					}
				} else if (p.gdp_average_gdp_average > 72.12){
					return {
						fillColor: '#756bb1'
					};
				} else if (p.gdp_average_gdp_average > 26.25){
					return {
						fillColor: '#9e9ac8'
					};
				} else if (p.gdp_average_gdp_average > 9.75){
					return {
						fillColor: '#cbc9e2'
					};
				} else {
					return {
						fillColor: '#f2f0f7'
					};
				}
			}
			
			function stilus_slope(feature){
				var p = feature.properties;
				
				if (p.slope_slope == "y = -149,26x + 1623,8") {
					return {
						fillColor: '#2166ac'
					}
				} else if (p.slope_slope == "y = -82,858x + 932,84"){
					return {
						fillColor: '#2166ac'
					};
				} else if (p.slope_slope == "y = -27,99x + 329,07"){
					return {
						fillColor: '#67a9cf'
					};
				} else if (p.slope_slope == "y = -23,818x + 250,64"){
					return {
						fillColor: '#67a9cf'
					};
				} else if (p.slope_slope == "y = -11,405x + 112,21"){
					return {
						fillColor: '#d1e5f0'
					};
				} else if (p.slope_slope == "y = -10,846x + 82,289"){
				 	return {
						fillColor: '#d1e5f0'
					};
				} else if (p.slope_slope == "y = -1,9731x + 33,534"){
					return {
						fillColor: '#f7f7f7'
					};
				} else if (p.slope_slope == "y = 3,8565x + 32,91"){
					return {
						fillColor: '#fddbc7'
					};
				} else if (p.slope_slope == "y = 4,0917x - 2,8023"){
					return {
						fillColor: '#fddbc7'
					};
				} else {
					return {
						fillColor: '#000000'
					};
				}
			}
			
			function stilus_r2(feature){
				var p = feature.properties;
				
				if (p.correlation_r2_values_leaflet_r2 > 0.8) {
					return {
						fillColor: '#7a0177'
					}
				} else if (p.correlation_r2_values_leaflet_r2 > 0.38){
					return {
						fillColor: '#c51b8a'
					};
				} else if (p.correlation_r2_values_leaflet_r2 > 0.201){
					return {
						fillColor: '#f768a1'
					};
				} else if (p.correlation_r2_values_leaflet_r2 > 0.02){
					return {
						fillColor: '#fbb4b9'
					};
				} else {
					return {
						fillColor: '#feebe2'
					};
				}
			}
			
			function mousehighlight (feature, layer) {
					// when hover over the feature, highlight it
					layer.on('mouseover', function () {
						this.setStyle({
							'weight': '6',
							'fillOpacity': '1',
							'border-width': '0.5',
						});
					});
					// when we go off the feature, return to default style
					layer.on('mouseout', function () {
						this.setStyle({
							'weight': '2',
							'fillOpacity': '0.7'
							
						});
					});
				}
				
				
			// map div object, main Leaflet object:
			var map = L.map('map',{maxBounds: L.latLngBounds(L.latLng(-29.935789, -94.974456), L.latLng(22.153948, -27.264859)),
									maxBoundsViscosity: 1.0,
									minZoom: 3
									}).setView([-6.641224624683114,-55.6095886343115], 4); 
			map.addControl(new L.Control.Fullscreen());
			map.scrollWheelZoom.disable();
			
			// base maps
			var OSM = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(map);
			
			// overlays			
			var x=new XMLHttpRequest();
			x.open('get', 'data/main_map_2.geojson', false);
			x.send();
			var d=JSON.parse(x.responseText);
			var mainmap_deforestation = L.geoJSON(d,{style: stilus_deforestation, onEachFeature: mousehighlight, color: 'white', weight: 2, fillOpacity: 0.7}).bindTooltip(tooltip_deforestation);
				mainmap_deforestation.getAttribution = function() { return 'TerraBrasilis: DETER dataset'; };
			var mainmap_population = L.geoJSON(d,{style: stilus_population, onEachFeature: mousehighlight, color: 'white', weight: 2, fillOpacity: 0.7}).bindTooltip(tooltip_population);
				mainmap_population.getAttribution = function() { return 'Instituto Brasileiro de Geografia e Estatística - IBGE'; };
			var mainmap_gdp = L.geoJSON(d,{style: stilus_gdp, onEachFeature: mousehighlight, color: 'white', weight: 2, fillOpacity: 0.7}).bindTooltip(tooltip_gdp);
				mainmap_gdp.getAttribution = function() { return 'Instituto Brasileiro de Geografia e Estatística - IBGE'; };
			
			// we add the default layer to map to show when page is opened:
				mainmap_deforestation.addTo(map)
			
			// list of overlays
			var overlayMaps = {
				"Deforestation": mainmap_deforestation,
				"Population density": mainmap_population,
				"GDP": mainmap_gdp
			};
			
			var layerControl = L.control.layers(overlayMaps, null, {collapsed:false}).addTo(map); 
			
			var tifftooltip_nirv;
			var tifftooltip_precip;
			
			
			
			
			// HIGHCHARTS - DEPENDENCY WHEEL:
			Highcharts.chart('container', {
				chart: {
					width: 700
				},
				title: {
					text: 'Correlation among social and natural factors'
				},				
				subtitle: {
					text: 'Subtitle is something'
				},
				// tooltip lower row format
				tooltip: {
					//pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
					//pointFormat: '{index}. From {point.from} to {point.to}: {point.weight} {point.mas}'
					pointFormat: 'Correlation between {point.from} and {point.to}: {point.source}'
				},				
				accessibility: {
					point: {
						valueDescriptionFormat: 'Correlation between {point.from} and {point.to}: {point.source}.'
					}
				},
				series: [{
					type: 'dependencywheel',
					name: 'Dependency wheel series', 				// appears on top of tooltip, indicating the series name
					cursor: 'pointer',								// make cursor a pointer cursor when hovering over the chart
					keys: ['from', 'to', 'weight', 'source'],
					data: [
						['valami', 'masvalami', 0.5, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['mittudomenmi', 'masvalami', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['wildfires', 'mittudomenmi', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['wildfires', 'hogy allnak epp a csillagok', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['wildfires', 'valami', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['logging', 'hogy allnak epp a csillagok', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['logging', 'valami', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['logging', 'masvalami', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['hogy allnak epp a csillagok', 'valami', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['valami', 'logging', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['valami', 'hogy allnak epp a csillagok', 1]
					],
					dataLabels: {
						color: '#333',
						style: {
							textOutline: 'none'
						},
						textPath: {
							enabled: true
						},
						distance: 10
					},
					size: '95%',
					events: {
						click: function (event) {
							// on click of a relation, open the reference URL (paper, literature) from field "source", if it exists:
							if (event.point.source != null) {
								window.open(event.point.source, "_blank");
							}
						}
					}
				}]			
			});
			

			setLegend('Deforestation (%)', [(8.09).toFixed(2), (3.63).toFixed(2), (1.23).toFixed(2), (0.5).toFixed(2)], ['#a50f15', '#de2d26', '#fb6a4a', '#fcae91', '#fee5d9']);	
			
			// STATIC MAP: LEGEND for values
			function setLegend(title, values, colors){
				legend_mainmap = L.control({position: 'bottomright'});
				legend_mainmap.onAdd = function(map) {
					var div = L.DomUtil.create("div");
					var content = '<div id="legenddiv" class="leaflet-bar custom-control legend">';
						content += '<div class="legendcolumnlist">';
							content += '<div class="legenditem" style="justify-content: center;">';
								content += '<span style="">'+title+'</span>';
							content += '</div>';
							content += '<div class="legenditem">';
								content += '<div style="background-color: '+colors[0]+'; width: 27px; height: 16px; margin-right: 5px;"></div>';
								content += '<span>'+values[0]+' < </span>';
							content += '</div>';
							content += '<div class="legenditem">';
								content += '<div style="background-color: '+colors[1]+'; width: 27px; height: 16px; margin-right: 5px;"></div>';
								content += '<span>'+values[1]+' - '+values[0]+'</span>';
							content += '</div>';
							content += '<div class="legenditem">';
								content += '<div style="background-color: '+colors[2]+'; width: 27px; height: 16px; margin-right: 5px;"></div>';
								content += '<span>'+values[2]+' - '+values[1]+'</span>';
							content += '</div>';
							content += '<div class="legenditem">';
								content += '<div style="background-color: '+colors[3]+'; width: 27px; height: 16px; margin-right: 5px;"></div>';
								content += '<span>'+values[3]+' - '+values[2]+'</span>';
							content += '</div>';
							content += '<div class="legenditem">';
								content += '<div style="background-color: '+colors[4]+'; width: 27px; height: 16px; margin-right: 5px;"></div>';
								content += '<span> > '+values[3]+'</span>';
							content += '</div>';
						content += '</div>';
					content += '</div>';
					
					div.innerHTML = content;
					  
					return div;
					
				};
				legend_mainmap.addTo(map);
			};
			
			// STATIC MAP: LEGEND for GRADIENTS
			function setLegend_gradient(values, unit, colors, targetmap){
				legend_mainmap = L.control({position: 'bottomright'});
				legend_mainmap.onAdd = function(map) {
				
				function colorcount(){
						var result = "";
						for (var i = 0; i<colors.length; i++) { result = result + colors[i] + ", " }
						result = result.slice(0, -2);
						return result;						
					}		
				
					var div = L.DomUtil.create("div");
					var content = '<div id="legenddiv" class="leaflet-bar custom-control legend">';
						content += '<div style="display: flex; flex-direction: column; margin-top: 4px; width: 130px;">';
							content += '<div style="background: linear-gradient(to right, '+colorcount()+') ; width: 100%; height: 14px;"></div>';
							content += '<div style="display: flex; flex-direction: row; justify-content: space-between;"><span>'+values[0]+'</span><span>'+values[1]+'</span></div><div style="display: flex; flex-direction: row; justify-content: center;">'+unit+'</div>';
						content += '</div>';
					content += '</div>';
					 
					div.innerHTML = content;
					  
					return div;
					
				};
				legend_mainmap.addTo(map);
			};
			
			
			map.on('baselayerchange', function (e) {
				map.removeControl(legend_mainmap);
				if (e.name === 'Deforestation') {
					setLegend('Deforestation (%)', [8.0892.toFixed(2), 3.6333.toFixed(2), 1.2308.toFixed(2), 0.4993.toFixed(2)], ['#a50f15', '#de2d26', '#fb6a4a', '#fcae91', '#fee5d9']);
				}  else if (e.name === 'Population density') {
					setLegend('Population density (per km<sup>2</sup>)', [parseFloat(6.180).toLocaleString(), parseFloat(4.790).toLocaleString(), parseFloat(3.210).toLocaleString(), parseFloat(1.910).toLocaleString()], ['#a63603', '#e6550d', '#fd8d3c', '#fdbe85', '#feedde']);
				} else if (e.name === 'GDP') {
					setLegend('GDP (R$ 1 billion)', [98.75, 72.75, 26.25, 9.75], ['#54278f', '#756bb1', '#9e9ac8', '#cbc9e2', '#f2f0f7']);
				} else if (e.name === 'NIRv') {
					setLegend_gradient([-0.082, 0.332], '', chroma.scale(['white', 'green']).colors(2), map); // first param is labels: [mix, max], second param is the colors from-to (min, then max)
				} else if (e.name === 'Precipitation') {
					setLegend_gradient([0, parseFloat(0.0616789758*1000).toFixed(3)], 'mm/day', chroma.scale(['red', 'orange', 'yellow', 'green', 'cyan', 'blue']).colors(5), map); // first param is labels: [mix, max], second param is the colors from-to (min, then max)
				} 
			});
			
			/////////////////////////////////
			// DYNAMIC DATA, ANIMATED MAP: //
			/////////////////////////////////
			
			var dynamic_currentlayer;
			
			// map div 2, for dynamic data 
			var map_dynamic = L.map('map_dynamic', {maxBounds: L.latLngBounds(L.latLng(-30, -90), L.latLng(15, -30)),
									maxBoundsViscosity: 1.0,
									minZoom: 3
									}).setView([-5,-60], 4);
			map_dynamic.addControl(new L.Control.Fullscreen());			
			map_dynamic.scrollWheelZoom.disable();
			
			var OSM = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(map_dynamic);
			
			// SLIDER BUTTON PANEL
			var buttonpanelControl = L.control({position: 'bottomleft'});
			buttonpanelControl.onAdd = function () {
				  var div = L.DomUtil.create('div');
				  div.innerHTML = '<div class="leaflet-bar custom-control" style="display: flex; flex-direction: column; align-items: center;"><div style="width: 100%; display: flex; justify-content: center;">2001-2021 (monthly mean)</div><div style="display: flex; flex-direction: row; align-items: center; justify-content: space-around; width: 100%;">						<span id="month" style="width: 20%;"> </span> <div><input id="loopcheckbox" name="loopcheckbox" type="checkbox" checked>						<label for="loopcheckbox">Loop</label></div><input type="button" value="Start" onclick="startStop(this)" />						</div><input id="monthslider" type="range" min="1" max="12" oninput="datumBeall(this.value)" style="width: 200px"/></div>';	
				  
					L.DomEvent.disableClickPropagation(div);
				  return div;
			};
			buttonpanelControl.addTo(map_dynamic);			
			buttonpanelControl.getContainer().addEventListener('mouseover', function () {
				map_dynamic.dragging.disable();
			});
			buttonpanelControl.getContainer().addEventListener('mouseout', function () {
				map_dynamic.dragging.enable();
			});
					
			map_dynamic.on('baselayerchange', function (e) {
				map.removeControl(legend_dyn);
				if (e.name === 'Precipitation (mean)') {
					if (layerNirv != null) {
						layerNirv.hide();
					}
					dynamic_currentlayer = "precip";
					loadTiffPrecip('data/meanmonths/precip_'+String(month).padStart(2, '0')+'.tif', true);
					setLegend_gradient_dynamic([0, 0.085*1000], 'mm/day', chroma.scale(['rgba(0,0,0,0)','rgba(0,0,255,0.5)', 'rgba(0,0,255,0.6)', 'rgba(0,0,255,0.7)' , 'rgba(0,0,255,0.82)' , 'blue']).colors(6), map_dynamic);
				} else if (e.name === 'NIRv (mean)') {
					/*if (layerPrecip != null) {
						layerPrecip.hide();
					}*/
					dynamic_currentlayer = "nirv";
					loadTiffNirv('data/nirv_months/nirv_'+String(month).padStart(2, '0')+'.tif', true);
					setLegend_gradient_dynamic([0, 0.3755], '', chroma.scale(['rgba(0,0,0,0)','rgba(0,100,0,0.2)', 'rgba(0,100,0,0.4)', 'rgba(0,100,0,0.6)' , 'rgba(0,100,0,0.82)' , 'darkgreen']).colors(6), map_dynamic);
				}
			});
			
			// DYNAMIC MAP: LEGEND for GRADIENTS
			function setLegend_gradient_dynamic(values, unit, colors, targetmap){
				legend_dyn = L.control({position: 'bottomright'});
				legend_dyn.onAdd = function(map_dynamic) {
					var div = L.DomUtil.create("div");
					var content = '<div id="legenddiv" class="leaflet-bar custom-control legend">';
						content += '<div style="display: flex; flex-direction: column; margin-top: 4px; width: 130px;">';
							content += '<div style="background: linear-gradient(to right, '+colors[0]+', '+colors[colors.length-1]+'); width: 100%; height: 14px;"></div>';
							content += '<div style="display: flex; flex-direction: row; justify-content: space-between;"><span>'+values[0]+'</span><span>'+values[1]+'</span></div><div style="display: flex; flex-direction: row; justify-content: center;">'+unit+'</div>';
						content += '</div>';
					content += '</div>';
					 
					div.innerHTML = content;
					  
					return div;
					
				};
				legend_dyn.addTo(map_dynamic);
			};
			
			var month = 1;
			document.getElementById('month').innerHTML=swapMonthNumberwithName(month);
			document.getElementById('monthslider').value=month;
			
			var x=new XMLHttpRequest();
			x.open('get', 'data/main_map_2.geojson', false);
			x.send();
			var d=JSON.parse(x.responseText);
			var dynamicmap_stateborders = L.geoJSON(d, {style: function (feature) { return {color: "#ffffff", weight: 2, fill: false} }, onEachFeature: function (feature, layer) {
				layer.bindTooltip(feature.properties.sigla, {permanent: true, direction:"center"});} });
				dynamicmap_stateborders.getAttribution = function() { return 'TerraBrasilis'; };
			dynamicmap_stateborders.addTo(map_dynamic)			
											
							
			// GeoTIFF in dynamic map
			var layerPrecip;
			var layerNirv;
			var tifftooltip_precip;
			var layerControl_dynamic;
			var precip_range;
			
			var overlayMaps_dynamic = { 
				/*"Precipitation (mean)": layerPrecip,
				"NIRv (mean)": layerNirv*/
				};
			
			function loadTiffPrecip(filename, add) {
				dynamic_currentlayer = "precip";
				d3.request(filename).responseType('arraybuffer').get( function (error, tiffData) {
				
					// if there is a geotiff layer loaded, remove it first
					if (layerPrecip != null && layerPrecip._visible != false) {
						//layerPrecip.remove();
						layerPrecip.hide();
					}
				
					let precip = L.ScalarField.fromGeoTIFF(tiffData.response, bandIndex = 0);
					layerPrecip = L.canvasLayer.scalarField(precip, {
							color: chroma.scale(['rgba(0,0,0,0)','rgba(0,0,255,0.5)', 'rgba(0,0,255,0.6)', 'rgba(0,0,255,0.7)' , 'rgba(0,0,255,0.82)' , 'blue']).domain([0, 0.085]),		// domain: the range. can be precip.range as well, range will be automatic from data then
							opacity: 1,
							attribution: '© 2022 <a href="www.ecmwf.int">European Centre for Medium-Range Weather Forecasts (ECMWF)</a>'
							});
					precip_range = precip.range;
					//console.log(precip_range)					
					
					// what happens upon mouse hover over the raster
					layerPrecip.on("mousemove", function(e) {
						// mouse moved
						if (e.value !== null) {							// value under mouse is not null
							if (tifftooltip_precip !== null) {			// if tifftooltip is already open, close the previous tooltip so it does not get stuck on map
								map_dynamic.closeTooltip(tifftooltip_precip);
							}
							// create tooltip:
							tifftooltip_precip = L.tooltip()
								.setLatLng(e.latlng)
								.setContent(parseFloat(`${e.value*1000}`).toFixed(3) + ' mm/day'); // CONVERSION FROM M/DAY TO MM/DAY
							map_dynamic.openTooltip(tifftooltip_precip);			// open tooltip
						} else {										// value is null
							if (tifftooltip_precip !== null) {			// if any tooltip is open, close it since we went elsewhere from the area with the cursor, so previous one does not get stuck
								map_dynamic.closeTooltip(tifftooltip_precip);
							}
						}
					});
					
					if (add) {
						// add the geotiff layer to map
						layerPrecip.addTo(map_dynamic);		
					}					
					
					// if there is no layer switcher yet, create one
					if (layerControl_dynamic == null) {
						setLegend_gradient_dynamic([0, 0.085*1000], 'mm/day', chroma.scale(['rgba(0,0,0,0)','rgba(0,0,255,0.5)', 'rgba(0,0,255,0.6)', 'rgba(0,0,255,0.7)' , 'rgba(0,0,255,0.82)' , 'blue']).colors(6), map_dynamic);
						// first run, add to map so we see by default, create layer switcher
						Object.assign(overlayMaps_dynamic, { "Precipitation (mean)": layerPrecip, "NIRv (mean)": layerNirv }); 
						layerControl_dynamic = L.control.layers(overlayMaps_dynamic, {"States": dynamicmap_stateborders}, {collapsed:false}).addTo(map_dynamic);
					}
				  
				});	
					
			}
			
			function loadTiffNirv(filename, add, initial) {
				dynamic_currentlayer = "nirv";
				d3.request(filename).responseType('arraybuffer').get( function (error, tiffData) {
									
					// if there is a geotiff layer loaded, remove it first
					if (layerNirv != null && layerNirv._visible != false) {
						//layerNirv.remove();
						layerNirv.hide();
					}
					
					let nirv = L.ScalarField.fromGeoTIFF(tiffData.response, bandIndex = 0);
					layerNirv = L.canvasLayer.scalarField(nirv, {
							color: chroma.scale(['rgba(0,0,0,0)','rgba(0,100,0,0.2)', 'rgba(0,100,0,0.4)', 'rgba(0,100,0,0.6)' , 'rgba(0,100,0,0.82)' , 'darkgreen']).domain([0, 0.3755]),		// domain: the range. can be precip.range as well, range will be automatic from data then
							opacity: 1,
							attribution: ''
							});
					nirv_range = nirv.range;
					//console.log(nirv_range)	
						
					
					// what happens upon mouse hover over the raster
					layerNirv.on("mousemove", function(e) {
						if (tifftooltip_precip.isOpen()) {
							map_dynamic.closeTooltip(tifftooltip_precip);
						}
					
						// mouse moved
						if (e.value !== null) {							// value under mouse is not null
							if (tifftooltip_nirv !== null) {			// if tifftooltip is already open, close the previous tooltip so it does not get stuck on map
								map_dynamic.closeTooltip(tifftooltip_nirv);
							}
							// create tooltip:
							tifftooltip_nirv = L.tooltip()
								.setLatLng(e.latlng)
								.setContent(parseFloat(`${e.value}`).toFixed(3)); 
							map_dynamic.openTooltip(tifftooltip_nirv);			// open tooltip
						} else {										// value is null
							if (tifftooltip_nirv !== null) {			// if any tooltip is open, close it since we went elsewhere from the area with the cursor, so previous one does not get stuck
								map_dynamic.closeTooltip(tifftooltip_nirv);
							}
						}
					});
					
					if (add) {
						layerPrecip.setOpacity(0);
						
						// add the geotiff layer to map
						layerNirv.addTo(map_dynamic);		
					}						
					
					// if there is no layer switcher yet, create one
					if (layerControl_dynamic == null) {
						//setLegend_gradient_dynamic([0, 0.085], '', chroma.scale(['rgba(0,0,0,0)','rgba(0,0,255,0.5)', 'rgba(0,0,255,0.6)', 'rgba(0,0,255,0.7)' , 'rgba(0,0,255,0.82)' , 'blue']).colors(6), map_dynamic);
						// first run, add to map so we see by default, create layer switcher
						//Object.assign(overlayMaps_dynamic, { "NIRv (mean)": layerNirv }); 
						//overlayMaps_dynamic = { "NIRv (mean)": layerNirv };
						//layerControl_dynamic = L.control.layers(overlayMaps_dynamic, {"States": dynamicmap_stateborders}, {collapsed:false}).addTo(map_dynamic); 
					}
					//Object.assign(overlayMaps_dynamic, { "NIRv (mean)": layerNirv }); 
					//layerControl_dynamic = L.control.layers(overlayMaps_dynamic, {"States": dynamicmap_stateborders}, {collapsed:false}).addTo(map_dynamic); 
				  
				});		
			}
			
			// load by default
			loadTiffNirv('data/nirv_months/nirv_01.tif', false, true);
			loadTiffPrecip('data/meanmonths/precip_01.tif', true);
				
			function datumBeall(ho){
				month = ho;
				document.getElementById('month').innerHTML = swapMonthNumberwithName(parseInt(ho));
				if (dynamic_currentlayer == "precip") {
					var nextfilename = 'data/meanmonths/precip_'+String(ho).padStart(2, '0')+'.tif';
					console.log(nextfilename)
					loadTiffPrecip(nextfilename, true);
				
				} else {		
					var nextfilename = 'data/nirv_months/nirv_'+String(ho).padStart(2, '0')+'.tif';
					console.log(nextfilename)
					loadTiffNirv(nextfilename, true);		
				}
			}
			
			var idozito;
			
			function startStop(b){
				if (b.value=="Start" || b.value=="Replay") {
					// ha veget ert az animacio, megallt mert nem loopos, es az ujra gombra kattintunk, visszaallitjuk a 2000-re
					if (month >= 12) {
						month = 0;
					}
					// elinditjuk a lejatszast
					idozito=setInterval(function(){
						document.getElementById('monthslider').disabled = true;
						month+=1;
						if (month > 12) {
							// a vegere ertunk, loop ellenorzes
							if (document.getElementById('loopcheckbox').checked) {
								// loop igen, menjunk elolrol
								month = 1;
							} else {
								// loop nem, alljunk meg a vegen
								month-=1;
								clearInterval(idozito);
								document.getElementById('monthslider').disabled = false;
								// gomb: "Replay"-t irjon, mert megalltunk es a vegen vagyunk
								b.value="Replay";
							}
						}
						datumBeall(month);
						document.getElementById('monthslider').value=month;
					},500); // 500 ms per step
					b.value="Stop";
				} else {
					// megallitjuk
					document.getElementById('monthslider').disabled = false;
					clearInterval(idozito);
					b.value="Start";
				}
			}
			
			function swapMonthNumberwithName(num) {
				switch(num) {
				  case 1:
					return 'January';
				  case 2:
					return 'February';
				  case 3:
					return 'March';
				  case 4:
					return 'April';
				  case 5:
					return 'May';
				  case 6:
					return 'June';
				  case 7:
					return 'July';
				  case 8:
					return 'August';
				  case 9:
					return 'September';
				  case 10:
					return 'October';
				  case 11:
					return 'November';
				  case 12:
					return 'December';
				  default:
					return num;
				} 
			}
			/*
			map_dynamic.on('baselayerchange', function (e) {
				map_dynamic.removeControl(legend_dyn);
				if (e.name === 'Precipitation (mean)') {
					setLegend_gradient([0, 0.085], 'mm/day', chroma.scale(['black', 'orange']).colors(2), map_dynamic);
				} 
			});*/
			 
			 
			 function tooltip_slope(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>Linear fit: " + layer.feature.properties.slope_slope + "</div>";
			}
			function tooltip_r2(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>R<sup>2</sup>: " + layer.feature.properties.correlation_r2_values_leaflet_r2 + "</div>";
			}
			 
			 // map div object,  Leaflet2 object:
			 
			var map_2 = L.map('map_2',{maxBounds: L.latLngBounds(L.latLng(-29.935789, -94.974456), L.latLng(22.153948, -27.264859)),
									maxBoundsViscosity: 1.0,
									minZoom: 3
								}).setView([-6.641224624683114,-55.6095886343115], 4); 
			map_2.addControl(new L.Control.Fullscreen());
			map_2.scrollWheelZoom.disable();
			
			// base maps
			var OSM = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(map_2);
			
			// overlays			
			var x=new XMLHttpRequest();
			x.open('get', 'data/correlation_r2_slope.geojson', false);
			x.send();
			var d=JSON.parse(x.responseText);
			var mainmap_slope = L.geoJSON(d,{style: stilus_slope, onEachFeature: mousehighlight, color: 'white', weight: 2, fillOpacity: 0.7}).bindTooltip(tooltip_slope);
				mainmap_slope.getAttribution = function() { return 'TerraBrasilis: DETER dataset'; };
			var mainmap_r2 = L.geoJSON(d,{style: stilus_r2, onEachFeature: mousehighlight, color: 'white',  weight: 2, fillOpacity: 0.7}).bindTooltip(tooltip_r2);
				mainmap_r2.getAttribution = function() { return 'Instituto Brasileiro de Geografia e Estatística - IBGE'; };
			
			
			// we add the default layer to map to show when page is opened:
				mainmap_slope.addTo(map_2)
			
			// list of overlays
			var overlayMaps_3rd = {
				
				"Linear fit ": mainmap_slope,
				"R<sup>2</sup>": mainmap_r2
			};
			var layerControl = L.control.layers(overlayMaps_3rd, null, {collapsed:false}).addTo(map_2);
			
			// R2/CORREL MAP: LEGEND for GRADIENTS
			function setLegend_gradient_r2correl(values, unit, colors){
				legend_r2correl = L.control({position: 'bottomright'});
				legend_r2correl.onAdd = function(map) {
				
				function colorcount(){
						var result = "";
						for (var i = 0; i<colors.length; i++) { result = result + colors[i] + ", " }
						result = result.slice(0, -2);
						return result;						
					}		
				
					var div = L.DomUtil.create("div");
					var content = '<div id="legenddiv" class="leaflet-bar custom-control legend">';
						content += '<div style="display: flex; flex-direction: column; margin-top: 4px; width: 130px;">';
							content += '<div style="background: linear-gradient(to right, '+colorcount()+') ; width: 100%; height: 14px;"></div>';
							content += '<div style="display: flex; flex-direction: row; justify-content: space-between;"><span>'+values[0]+'</span><span>'+values[1]+'</span></div><div style="display: flex; flex-direction: row; justify-content: center;">'+unit+'</div>';
						content += '</div>';
					content += '</div>';
					 
					div.innerHTML = content;
					  
					return div;
					
				};
				legend_r2correl.addTo(map_2);
			};
			
			setLegend_gradient_r2correl([-150, 5], '', chroma.scale(['#2166ac', '#67a9cf', '#d1e5f0', '#f7f7f7', '#fddbc7']).colors(5));
			
			map_2.on('baselayerchange', function (e) {
				map_2.removeControl(legend_r2correl);
				if (e.name === 'Linear fit ') {
					setLegend_gradient_r2correl([-150, 5], '', chroma.scale(['#2166ac', '#67a9cf', '#d1e5f0', '#f7f7f7', '#fddbc7']).colors(5));
				} else if (e.name === 'R<sup>2</sup>') {
					setLegend_gradient_r2correl([0.02, 0.905], '', chroma.scale(['#feebe2', '#fbb4b9', '#f768a1', '#c51b8a', '#7a0177']).colors(5));
				} 
			});
			
			 // DUAL AXIS CHART 1
			 
			 
			 var data = {
				"datasets": [
				  {
					"backgroundColor": "rgb(165,15,21)",
					"borderColor": "rgb(165,15,21)",
					"fill": false,
					"data": [19.624, 17.85, 29.43, 53.314, 138.498, 128.354, 244.602, 226.432, 331.004, 155.59, 37.276, 33.356],
					"label": "Deforestation",
					"yAxisID":"y1"
				  },
				  {
					"backgroundColor": "rgb(8,81,156)",
					"borderColor": "rgb(8,81,156)",
					"fill": false,
					"data": [9.862585687, 9.80565275, 10.82662277, 11.46246432, 9.35921619, 4.988833866, 2.98230954, 2.798426994, 3.997075154, 5.718009035, 8.270209801, 10.44341969],
					"label": "Precipitation",
					"yAxisID":"y2"
				  }
				],
				"labels": [
				  "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
			  };
			  
			var options = {
					plugins: {
						title: {
							display: true,
							text: "Rondônia"
					}
				},
				responsive: true,
				interaction: {
					mode: 'index',
					intersect: false
				},
				elements: {
				  "rectangle": {
					"borderWidth": 2
				  }
				},
				layout: {
				  "padding": 0
				},
				legend: {
				  "display": true,
				  "labels": {
					"boxWidth": 16
				  }
				},
				maintainAspectRatio: false,
				responsive: true,
				scales: {
					"y1": { 
							title: {
								display: true,
								text: 'Deforestation (km\u00B2)'						
							},
						position: 'left'
					},
					"y2": {
							title: {
								display: true,
								text: 'Precipitation (mm/day)'						
							},
						position: 'right',
						grid: {
						  drawOnChartArea: false, // only want the grid lines for one axis to show up
						}
					}
				},
				tooltips: {
				  "intersect": false,
				  "mode": "index",
				  "position": "nearest",
				  "callbacks": {}
				}
			};
				
			var type = "line";

			var myChart = new Chart(document.getElementById("dualaxisChart").getContext('2d'), {options: options, data: data, type: type});
			
			
			
			// DUAL AXIS CHART 2
			
			var data2 = {
				"datasets": [
				  {
					"backgroundColor": "rgb(165,15,21)",
					"borderColor": "rgb(165,15,21)",
					"fill": false,
					"data": [27.718, 4.07, 1.8, 42.48, 4.924, 13.552, 2.344, 29.688, 87.424, 37.168, 25.976, 4.184],
					"label": "Deforestation",
					"yAxisID":"y1"
				  },
				  {
					"backgroundColor": "rgb(8,81,156)",
					"borderColor": "rgb(8,81,156)",
					"fill": false,
					"data": [8.682142972, 12.62437333, 11.56642087, 8.811882839, 3.618205447, 1.155493223, 0.716872719, 0.346232603, 0.627226216, 1.625703192, 5.090730096, 6.503446867],
					"label": "Precipitation",
					"yAxisID":"y2"
				  }
				],
				"labels": [
				  "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
			  };
			  
			options.plugins.title.text = 'Tocantins';
			var myChart2 = new Chart(document.getElementById("dualaxisChart2").getContext('2d'), {options: options, data: data2, type: type});
			
			
			// DUAL AXIS CHART 3
			
			var data3 = {
				"datasets": [
				  {
					"backgroundColor": "rgb(165,15,21)",
					"borderColor": "rgb(1165,15,21)",
					"fill": false,
					"data": [482, 435, 865, 773, 932, 684, 1030, 1376, 1243, 1316, 1257, 1273, 1673],
					"label": "Deforestation",
					"yAxisID":"y1",
					"order": 2
				  },
				  {
					"backgroundColor": "rgb(8,81,156)",
					"borderColor": "rgb(8,81,156)",
					"fill": false,
					"data": [8.12, 6.92, 7.91, 7.31, 7.86, 8.11, 7.26, 7.45, 7.70, 7.09, 8.13, 7.12, 7.67],
					"label": "Precipitation",
					"type": 'line',
					"yAxisID":"y2"
				  },
				  {
					"backgroundColor": "rgb(203,201,226)",
					"borderColor": "rgb(203,201,226)",
					"fill": false,
					"data": [19.725, 23.908, 27.575, 30.113, 31.121, 34.031, 36.563, 39.461, 43.516, 44.914, 47.0913],
					"label": "GDP",
					"type": 'line',
					"yAxisID":"y3"
				  }
				],
				"labels": [
				  "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021"]
			  };
			  
			  var options2 = {
					  plugins: {
							title: {
								display: true,
								text: "Rondônia"
							}
						},
				responsive: true,
				interaction: {
					mode: 'index',
					intersect: false
				},
				elements: {
				  "rectangle": {
					"borderWidth": 2
				  }
				},
				layout: {
				  "padding": 0
				},
				legend: {
				  "display": true,
				  "labels": {
					"boxWidth": 16
				  }
				},
				maintainAspectRatio: false,
				responsive: true,
				scales: {
					"y1": {
							title: {
								display: true,
								text: 'Deforestation (km\u00B2)'						
							},
						position: 'left'
					},
					"y2": { 
							title: {
								display: true,
								text: 'Precipitation (mm/day)'						
							},
						position: 'right',
						grid: {
						  drawOnChartArea: false, // only want the grid lines for one axis to show up
						}
					},
					"y3": {
							title: {
								display: true,
								text: 'GDP (1 billion BRL)'						
							},
						position: 'right',
						grid: {
						  drawOnChartArea: false, // only want the grid lines for one axis to show up
						}
					}
				},
				tooltips: {
				  "intersect": false,
				  "mode": "index",
				  "position": "nearest",
				  "callbacks": {}
				}
			};
				
			var type = "bar";
			
			var myChart3 = new Chart(document.getElementById("dualaxisChart3").getContext('2d'), {options: options2, data: data3, type: type});
			
			// DUAL AXIS CHART 4
			
			var data4 = { 
				"datasets": [
				  {
					"backgroundColor": "rgb(165,15,21)",
					"borderColor": "rgb(1165,15,21)",
					"fill": false,
					"data": [61, 49, 40, 52, 74, 50, 57, 58, 31, 25, 23, 25, 37],
					"label": "Deforestation",
					"yAxisID":"y1",
					"order": 2
				  },
				  {
					"backgroundColor": "rgb(8,81,156)",
					"borderColor": "rgb(8,81,156)",
					"fill": false,
					"data": [6.48, 4.63, 5.74, 4.40, 5.33, 4.70, 3.84, 4.31, 5.18, 5.33, 4.68, 5.16, 5.23],
					"label": "Precipitation",
					"type": 'line',
					"yAxisID":"y2"
				  },
				  {
					"backgroundColor": "rgb(203,201,226)",
					"borderColor": "rgb(203,201,226)",
					"fill": false,
					"data": [13.689804, 16.404816, 18.345688, 20.684430, 23.796656, 26.189323, 28.930291, 31.584816, 34.108132, 35.666183, 39.355941],
					"label": "GDP",
					"type": 'line',
					"yAxisID":"y3"
				  }
				],
				"labels": [
				  "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021"]
			  };
		
			var type = "bar";
			
			options2.plugins.title.text = 'Tocantins';
			var myChart4 = new Chart(document.getElementById("dualaxisChart4").getContext('2d'), {options: options2, data: data4, type: type});
		
			// SCATTER Plot 1
			
			var ctx = document.getElementById("scatterplot").getContext('2d');

			// Define the data 
			var data5 = {
				"datasets": [
				  {       
					label: "Rondônia",
					borderColor: '#2196f3',
					backgroundColor: '#2196f3', 
					trendlineLinear: {
						lineStyle: "solid",
						width: 2
						},
					data: [{
							x: 9.8625856866,
							y: 19.624
						}, {
							x: 9.8056527496,
							y: 17.85
						},
						{
							x: 10.8266227666,
							y: 29.43
						},
						{
							x: 11.46246432,
							y: 53.314
						},
						{
							x: 9.3592161904,
							y: 138.498
						},
						{
							x: 4.988833866,
							y: 128.354
						},
						{
							x: 2.9823095396,
							y: 244.602
						},
						{
							x: 2.7984269938,
							y: 226.432
						},
						{
							x: 3.9970751536,
							y: 331.004
						},
						{
							x: 5.7180090346,
							y: 155.59
						},
						{
							x: 8.2702098008,
							y: 37.276
						},
						{
							x: 10.4434196884,
							y: 33.356
						}
					 ]
				},
				{
					label: "Tocantins",
					borderColor: '#f49968',
					backgroundColor: '#f49968',
					trendlineLinear: {
						lineStyle: "solid",
						width: 2
						},
					data: [{
							x: 8.68214297199991,
							y: 27.718
						}, {
							x: 12.6243733272332,
							y: 4.07
						},
						{
							x: 11.5664208675017,
							y: 1.8
						},
						{
							x: 8.81188283859937,
							y: 42.48
						},
						{
							x: 3.61820544731617,
							y: 4.924
						},
						{
							x: 1.15549322276073,
							y: 13.552
						},
						{
							x: 0.716872719471636,
							y: 2.344
						},
						{
							x: 0.346232602552039,
							y: 29.688
						},
						{
							x: 0.627226215892753,
							y: 87.424
						},
						{
							x: 1.6257031918881,
							y: 37.168
						},
						{
							x: 5.09073009614505,
							y: 25.976
						},
						{
							x: 6.50344686698301,
							y: 4.184
						}
					 ]
				}]
			};
					 
			// End Defining data
			var options_scatter = {responsive: true, // Instruct chart js to respond nicely.
				maintainAspectRatio: false,
				scales: {
					y: {
					  title: {
						display: true,
						text: 'Deforestation (km\u00B2)'
					  }
					},
					x: {
					  title: {
						display: true,
						text: 'Precipitation (mm/day)'
					  }
					}
				},
				interaction: {
						mode: 'index',
						intersect: false
					}				// Add to prevent default behaviour of full-width/height 
			};

			// End Defining data
			var myChart5 = new Chart(ctx, {
				type: 'scatter',
				data: data5,
				options: options_scatter
			});			
			
			function downloadimage() {
				var a = document.createElement('a');
				a.href = myChart5.toBase64Image();
				a.download = "myChart5.png";
				a.click();			
			}
		</script>
	</body>
</html>