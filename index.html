<!doctype html>

<html>
	<head>
		<title>Amazon deforestation</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
		<meta charset="utf-8">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans">
		<!-- Chart.js: -->
		<script src="chartjs/chart.js"></script>
		<script src="chartjs/chartjs-plugin-trendline.js"></script>
		<!-- Leaflet: -->
		<link rel="stylesheet" href="leaflet/leaflet.css" />
		<script src="leaflet/leaflet.js"></script>
		<link rel="stylesheet" href="leaflet/leaflet.fullscreen.css" />
		<script src="leaflet/leaflet.fullscreen.js"></script>
		<!-- for reading GeoTIFF: -->
		<script src="leaflet/d3.v4.min.js"></script>
		<script src="leaflet/geotiff.js"></script>
		<script src="leaflet/leaflet.canvaslayer.field.js"></script>
		<script src="leaflet/chroma.min.js"></script>
		<!-- Highcharts -->
		<script src="highcharts/highcharts.js"></script>
		<script src="highcharts/sankey.js"></script>
		<script src="highcharts/dependency-wheel.js"></script>
		<script src="highcharts/exporting.js"></script>
		<script src="highcharts/export-data.js"></script>
		<script src="highcharts/accessibility.js"></script>
		<!-- Juxtapose.js -->
		<script src="juxtapose/juxtapose.min.js"></script>
		<link rel="stylesheet" href="juxtapose/juxtapose.css">
		<style>
			/* Globals */
			html, body {
				height: 100%;
				margin: 0;
				font-family: 'Open Sans', 'OpenSans-Local';
				font-style: normal;
				color: #5D5D5A;
				background-color: #FFF4E3;
				scroll-behavior: smooth;
			} 			
			p {
				text-align: justify;
				color: #5D5D5A;
			}
			#conceptual h4 {
				margin-bottom: 1px;
			}
			#conceptual p {
				margin-top: 5px;
				margin-bottom: 5px;
			}
			
			/* Leaflet map containers */
			#map, #map_dynamic, #map_2 {
				width: 55%;
				height: 400px;
				margin:  auto;
			}
			
			/* Content section (one revealed at a time) */
			.section {
				padding-left: 250px;
				padding-right: 250px;
				padding-top: 5px;
				padding-bottom: 5px;
			}
			/* Site-wide image section optional options */
			.imagesection {
				position: relative;
				width: 100%;
				height: 39rem;
			}
			.imagesection img {
				width: 100%; 
				height: 100%; 
				object-fit: cover;
			}
			/* Site-wide image: text overlay */
			.cim_a_kepen {
				color: white; 
				font-weight: bold; 
				font-size: 15pt;
				text-shadow: 2px 2px 5px #000000c7;
			}
			.cim_a_kepen_position {
				position: absolute;
				text-align: center;
				top: 0;
				left: 0;
				height: 100%;
				padding: 0 15% 0 15%;
				display: flex;
				justify-content: center;
				align-items: center;
			}
			
			.datawrapper_element {
			  background-color: white;
			  padding-top: 10px;
			  padding-bottom: 10px;
			  padding-left: 30px;
			  padding-right: 30px;
			}
			/* Scroll reveal animation: https://alvarotrigo.com/blog/css-animations-scroll/ */
			.reveal {
			  position: relative;
			  transform: translateY(150px);
			  opacity: 0;
			  transition: 2s all ease;
			}
			.reveal.active{
			  transform: translateY(0);
			  opacity: 1;
			}
			
			/* Top bar container */
			#topbar {
				background-color: #FFF4E3;
				width: 100%;
				top: 0;
				min-height: 75px;
				padding-top: 6px;
				padding-bottom: 6px;
				padding-left: 38px;
				padding-right: 38px;
				display: flex;
				box-sizing: border-box;
				z-index: 10000;
				position: relative;
				box-shadow: 0px 2px 6px 0px #00000038;
			}
			/* Links in topbar */
			#topbar a {
				font-size: 16px;
				text-align: center;
				padding: 10px 10px;
				text-decoration: none;
				border-radius: 3px;
				transition: background-color 0.2s ease-out;
				color: #5D5D5A;
			}
			/* Hover over links in topbar */
			#topbar a:hover {
				background-color: #FFCDAB;
				font-weight: bold;
			}
			
			/* Highcharts */
			.highcharts-data-table table {
				font-family: Verdana, sans-serif;
				border-collapse: collapse;
				border: 1px solid #ebebeb;
				margin: 10px auto;
				text-align: center;
				width: 100%;
				max-width: 500px;
			}
			.highcharts-data-table caption {
				padding: 1em 0;
				font-size: 1.2em;
				color: #555;
			}
			.highcharts-data-table th {
				font-weight: 600;
				padding: 0.5em;
			}
			.highcharts-data-table td,
			.highcharts-data-table th,
			.highcharts-data-table caption {
				padding: 0.5em;
			}
			.highcharts-data-table thead tr,
			.highcharts-data-table tr:nth-child(even) {
				background: #f8f8f8;
			}
			.highcharts-data-table tr:hover {
				background: #f1f7ff;
			}
			.highcharts-background {
				fill: #FFF4E3;
			}
			#csv {
				display: none;
			}
			
			/* Legends */
			.legend {
				display: flex; 
				flex-direction: row; 
				justify-content: flex-start; 
				grid-column-gap: 10px;
			}
			.legend span {
				position: relative;
				bottom: 3px;
				margin-top: 6px;
			}
			.legendcolumnlist {
				display: flex; 
				flex-direction: column; 
				justify-content: center; 
				grid-row-gap: 1px;
			}
			.legenditem {
				display: flex; 
				flex-direction: row; 
				align-items: center;
			}
			.custom-control {
				background-color: #FFFFFFDD; 
				padding: 6px 8px;
			}
			
			/* Dynamic map: control panel */
			#buttonpanel {
				position: absolute;
				bottom: 5px;
				left: 5px;
				background: rgba(255,255,255,0.4);
				padding: 10px;
				border: solid 2px black;
				border-radius: 5px;
				z-index: 10000;
				text-align: center;
				backdrop-filter: blur(10px);
			}
			
			/* Footer container */
			#footer {
				display: flex;
				bottom: 0px;
				width: 100%;
				justify-content: center;
				column-gap: 50px;
				flex-direction: row;
				height: 90px;
				align-items: center;
				margin-top: 50px;
				background-color: #ffddc6;
				box-sizing: border-box;
				z-index: 10000;
				position: relative;
				box-shadow: 0px -2px 6px 0px #00000038;
				text-align: center;
			}
			
			#footer div {
				margin-left: 20px;
				margin-right: 20px;
			}
			
			/* Site-wide image caption (attribution, source, license) */
			.img_wide_caption {
				position: absolute;
				height: 20px; 
				right: 0px;
				margin-top: -29px; 
				padding: 4px 5px 0px 6px;
				color: white;
				font-size: 8pt;
				background: rgba(255,255,255,0.41);
				width: fit-content;
				border-radius: 3px 0px 0px 0px;
				backdrop-filter: blur(2px);
			}
			
			/* Chartjs container width limiter */
			.chartjsdiv {
				max-width: 650px;
				margin: auto;
				width: 45%;
			}
			
			/* Some mobile optimization */
			@media (max-width: 1664px) {
				.cc_bmargin {
					margin-bottom: 32px !important;
				}
			}
			@media (max-width: 1215px) {
				.section {
					padding-left: 20px; 
					padding-right: 20px;			
				}
				#map, #map_dynamic, #map_2 {
					width: 90%;
					height: 400px;
					margin:  auto;
				}
				p {
					font-size: 12px;
				}
				h2 {
					font-size: 1.2em;
				}
				.cim_a_kepen {
					font-size: 12pt;
				}
				.cc_bmargin {
					margin-bottom: 0px !important;
				}
			}
			@media (max-width: 1017px) {
				.cc_bmargin {
					margin-bottom: 16px !important;
				}
			}
			@media (max-width: 790px) {
				h1 {
					font-size: 12pt !important;
				}
				#topbar a {
					font-size: 12px !important;
				}
				.img_wide_caption {
					font-size: 7pt;
				}
				#footer {
					flex-direction: column !important;
					row-gap: 5px !important;
				}
			}
			@media (max-width: 751px) {
				.cc_bmargin {
					margin-bottom: 33px !important;
				}
			}
			@media (max-width: 679px) {
				.img_wide_caption {
					width: 100% !important;
					padding: 4px 0 0 0 !important;
					border-radius: 0 !important;
					text-align: center !important;
					height: 32px !important;
					margin-top: -41px !important;
					overflow: hidden !important;
				}
				.imagesection {
					height: 22rem !important;
				}
			}
			@media (max-width: 595px) {
				#topbar_menubuttons {
					/*max-width: 100%;*/
				}
				#section1 p {
					width: 100% !important;
				}
				#s1_leftright {
					flex-direction: column !important;
				}
				#map {
					width: 100% !important;
					margin-left: 0 !important;
					margin-top: 8px !important;
				}
				#map_dynamic {
					width: 100% !important;
				}
				#container {
					width: 100% !important;
					height: 600px !important;
					float: none !important;
				}
				.charts_sidebyside {
					flex-direction: column !important;
				}
				.chartjsdiv {
					max-width: none !important;
					margin: unset !important;
					width: unset !important;
					height: 270px !important;
				}
				#map_2 {
					width: 100% !important;
				}
				#references ul {
					text-align: justify !important;   
					word-wrap: break-word !important;
				}
				#footer {
					font-size: 10pt;
				}
			}
			@media (max-width: 435px) {
				.cc_bmargin {
					margin-bottom: 33px !important;
				}
			}
			
		</style>
	</head>
	<body>
		
		<div id="topbar">
			<div style="display: flex; flex-direction: column; justify-content: space-between; align-items: center; width: 100%">
				
				<h1 style="font-size: 26px; text-align: center;">A call for multi-disciplinary perspectives to combat deforestation of the Amazon rainforest</h1>
				<div style="display: flex; flex-direction: row; column-gap: 10px; align-items: center; justify-content: center; flex-wrap: wrap;" id="topbar_menubuttons">
					<a href="#section1" class="item">State level indicators</a>
					<a href="#section2" class="item">Gridded variables</a>
					<a href="#section3" class="item">Feedbacks and interactions</a>
					<a href="#section4" class="item">Deforestation</a>
					<a href="#section5" class="item">Process interactions</a>
					<a href="#section6" class="item">Sensitivities</a>
				</div>
			</div>
		</div>
			
		<div id="maincontent" style="display: flex; flex-direction: column; row-gap: 5px;">			
			
			<div id="imagesection1" class="imagesection">				
				<img src="forest.jpg"></img>
				<!-- <div class="cim_a_kepen_position cim_a_kepen"></div> -->
				<div class="img_wide_caption">Aerial view of the Amazon Rainforest, near Manaus, the capital of the Brazilian state of Amazonas. Author: Neil Palmer (CIAT). Licensed under <a href="https://creativecommons.org/licenses/by-sa/2.0/deed.en">CC BY-SA 2.0</a>.</div>
			</div>
			
			<div id="section0" class="section reveal">
				<h2>Summary</h2>
				<p>
					The Amazon forest is the largest tropical forest and a hotspot for biodiversity, sequestering large amounts of carbon and 
					regulating moisture transport across the region. Since the early 2000s, the rate of deforestation in the Amazon has steadily 
					reduced, but is rising again since ~2018, following changes in Brazil’s political leadership. Deforestation is a highly complex 
					process, influenced by both natural processes and societal factors, and uncovering this complexity can inform policy-making 
					to reverse the current trend in deforestation. Based on a review of literature and assessment of satellite observations, 
					climate data and key societal metrics, we highlight important interlinkages and feedbacks related to deforestation. Further,
					we find large regional differences within the Amazon biome and demonstrate that deforestation in the western part of the Amazon
					basin is more strongly related to variability in natural drivers (e.g. precipitation) than for the eastern and southern regions.
					Here we will present our preliminary analysis, which underlies our call for multidisciplinary perspectives and concerted action
					to combat deforestation in the Amazon forest.
				</p>
			</div>
			
			<div id="section1" class="section reveal">
				<h2>State level indicators</h2>				
				<div id="s1_leftright" style="display: flex; flex-direction: row;">
					<p style="width: 50%; margin: 0">
						The Amazon is the largest tropical forest and offers many important ecosystem services, including the sequestration of substantial
						amounts of carbon, recycling of moisture and supporting biodiversity. Although we refer to the ‘Amazon’	as a single ecosystem, 
						we stress that this is a heterogeneous area with large spatial and temporal variations.<br><br>
						To illustrate this, we will explore the variation of several social factors and climatic variables across the Amazon basin and the 
						neighboring states Maranhao and Tocantins. The map shows the distribution of some key variables at the state level. The states Amazonas
						and Roraima in the Western part have relatively low deforestation, low population density and low GDP. Deforestation rates are most
						extreme in the state Rondônia.
					</p>
					<div id="map" style="width: 50%; margin-left: 30px"></div>
				</div>
			</div>
			
			<div id="section2" class="section reveal">
				<h2>Gridded variables</h2>
				<p style="">
					Climatic variables also vary over the Amazon basin as demonstrated on the map. Highest precipitation rates occur in the Western part
					of the Amazon, with lowest rates occurring in the Eastern part of the Amazon during the dry season. These different precipitation
					regimes affect vegetation, which is also reflected in the spatiotemporal variations of near infrared reflectance of vegetation (NIRv), 
					a remote sensing-based proxy for photosynthesis <a href="#references">(Badgley et al., 2017)</a>.
				</p>
				<div id="map_dynamic"></div>
			</div>
			
			<div id="section3" class="section reveal">
				<h2>Feedbacks and interactions</h2>
				<p style="">
					There are many interactions and feedbacks between different processes (e.g. <a href="#references">Flores & Staal, 2022</a>), here we highlight the most important processes using the visualization below.
				</p>
				<div id="conceptual" style="<!--display: flex; justify-content: center;-->"> 
					<div id="container" style="width: 55%; height: 700px; float: left; margin-right: 15px;"></div>
					<h4 style="margin-top: 0;">Deforestation and Fires ➤ Human Health and Wellbeing</h4>
					<p>
						Deforestation can lead to economic and societal gains in the short term, as expressed by the Human Development Index (e.g. <a href="#references">Rodrigues et al., 2009</a>), 
						but lead to the opposite effects over a longer time period.	Fires release particles in the atmosphere that are damaging to human health (e.g., <a href="#references">Butt et al. 2022</a>)
					</p>

					<h4>Energy and Transport infrastructure ➤ Deforestation and Fires</h4>
					<p>
						Deforestation is needed for the construction of highways through the Amazon <a href="#references">(Fearnside, 2015)</a>, but also enables more deforestation by providing 
						access to the forest for heavy equipment. Dam construction also necessitates clearing of forests and affects the remaining forest by e.g. casting shadows.
						<a href="#references">(Schöngart et al., 2021)</a>
					</p>
					
					<h4>Energy and Transport infrastructure ➤ Atmospheric CO<sub>2</sub> and Climate Change</h4>
					<p>
						Economic development is often associated with fossil fuel combustion and release of CO<sub>2</sub> into the atmosphere. 
						The atmospheric concentration over the Amazon is the result of atmospheric mixing and accumulation of global 
						emissions since the start of the industrial revolution (e.g. <a href="#references">Betts et al., 2016)</a>. 
						Also the large Bablina hydrodam in the Amazon results in significant CO<sub>2</sub> emissions <a href="#references">(Kemenes et al., 2011)</a>
					</p>
					
					<h4>Agriculture and Timber production ➤ Deforestation and Fires</h4>
					<p>
						Agriculture requires fertile soils and is one of the human drivers of deforestation 
						<a href="#references">(Morton et al, 2006)</a> and was identified as the main driver for deforestation
						<a href="#references">(Pendrill et al., 2022)</a>. Also, the extraction of trees for timber production 
						is an important driver for deforestation.
					</p>
					
					<h4>Atmospheric CO<sub>2</sub> and Climate Change ➤ Photosynthesis and Carbon Sequestration</h4>
					<p>
						Elevated CO<sub>2</sub> concentrations can lead to higher photosynthesis rates e.g. 
						<a href="#references">de Almeida Castanho et al. (2016)</a> through CO<sub>2</sub> fertilization.
					</p>
					
					<h4>Atmospheric CO<sub>2</sub> and Climate Change ➤ Droughts and Moisture recycling</h4>
					<p>
						Due to climate change, the frequency of droughts is increasing <a href="#references">(Duffy et al., 2015)</a> 
						and the dry season has become warmer <a href="#references">(Gatti et al., 2021)</a>
					</p>
					
					<h4>Droughts and Moisture recycling ➤ Photosynthesis and Carbon Sequestration</h4>
					<p>
						When vegetation is moisture-limited, the plants will experience stress in case the supply of water is reduced,
						or when the demand for moisture is increased. Although rain forests are usually wet, severe droughts can lead 
						to stressed vegetation and reduced carbon uptake, as was e.g. witnessed during the severe drought during the 
						2015/16 El Nino <a href="#references">(Koren et al, van Schaik et al)</a>
					</p>
					
					<h4>Deforestation and Fires ➤ Photosynthesis and Carbon Sequestration</h4>
					<p>
						Aerosols and smoke from fires leads to a larger fraction of diffuse radiation, which can stimulate photosynthetic 
						uptake <a href="#references">(Rap et al., 2015; Silva et al., 2023)</a>
					</p>
					
					<h4>Deforestation and Fires ➤ Atmospheric CO<sub>2</sub> and Climate Change</h4>
					<p>
						Fires emit carbon dioxide which accumulates in the atmosphere. Emission can be directly in the form of CO<sub>2</sub>, 
						or indirectly in the form of CO, which later oxidizes in the atmosphere to form CO<sub>2</sub> <a href="#references">(Naus et al., 2022)</a>
					</p>
					
					<h4>Photosynthesis and Carbon Sequestration ➤ Atmospheric CO<sub>2</sub> and Climate Change</h4>
					<p>
						Photosynthesis removes CO<sub>2</sub> from the atmosphere. Photosynthesis rates in tropical forests are high 
						<a href="#references">(Beer et al., 2010)</a> and the forests contain large amounts of aboveground 
						biomass <a href="#references">(Saatchi et al., 2011)</a>.
					</p>
					
					<h4>Deforestation and Fires ➤ Droughts and Moisture recycling</h4>
					<p>
						Deforestation leads to a reduction of transpiration of water. This reduces the moisture that can be recycled 
						<a href="#references">(e.g. van der Ent et al., 2010)</a>, leading to reductions in precipitation 
						<a href="#references">(Zemp et al., 2017, Smith et al., 2023)</a>
					</p>
					
					<h4>Forest structure and Biodiversity ➤ Deforestation and Fires</h4>
					<p>
						The forest structure is one of the determinants for the susceptibility of the forest 
						to fires <a href="#references">(Van Nes et al., 2018)</a>
					</p>
				</div>
			</div>
			
			<div id="section4" class="section reveal">
				<h2>Deforestation</h2>
				<p style="">
					Rondônia is highly affected by deforestation. This can also be diagnosed directly from visual observations from satellite observations. 
					The comparison below highlights a heavily deforested region in state Rondônia using Landsat satellite images captured during December of 2001 and 2021. 
				</p>
				<div id="juxtapose_wrap" class="juxtapose"></div>
			</div>

			<div id="section5" class="section reveal">
				<h2>Process interactions</h2>
				<p style="">
					To quantify relations between different processes we have selected two contrasting states: Rondônia, heavily influenced by deforestation,
					and Tocantins, which is less heavily affected by deforestation.<br><br>
					There is a clear wet and dry season for both states, and the peak deforestation occurs during the dry periods. 
				</p>
				<div class="charts_sidebyside" style="display: flex; flex-direction; row;">
					<div class="chartjsdiv">
						<canvas id="dualaxisChart" width="100%" height="400px"></canvas>
					</div>
					<div class="chartjsdiv">
						<canvas id="dualaxisChart2" width="100%" height="400px"></canvas>
					</div>
				</div>
				<p style="">
					In contrast, the annual patterns in deforestation do not have a clear relation to annual precipitation: whereas the deforestation has
					substantial year-to-year variability (an increase for Rondônia, and a sudden drop after 2016 for Tocantins), the precipitation is relatively constant.
				</p>
				<div class="charts_sidebyside" style="display: flex; flex-direction; row;">
					<div class="chartjsdiv">
						<canvas id="dualaxisChart3" width="100%" height="400px"></canvas>
					</div>
					<div class="chartjsdiv">
						<canvas id="dualaxisChart4" width="100%" height="400px"></canvas>
					</div>
				</div>
				
		</div>
		
		<div id="section6" class="section reveal">
			<h2>Sensitivities</h2>
			<p style="">
				Next, we explore the sensitivity between deforestation and precipitation for the states Rondônia and Tocantins. Whereas for both
				states we find a negative slope (higher deforestation in dry years), the magnitude of this slope is much larger for Rondônia.
			</p>
			<div class="chartjsdiv">
				<canvas id="scatterplot" width="100%" height="400px"></canvas>
			</div>
			<p style="">
				Finally, we summarize this relation for all states. The slopes for the different states are mostly negative: indicating more 
				deforestation in driest periods. The states Roraima and Amapá (with relatively low deforestation rate) are exceptions to this 
				rule. The R² shows how strong the correlation between processes is. Overall, we find that the states in the most remote, western 
				regions of the Amazon are controlled most strongly by variability in the precipitation over this region.
			</p>
			<div id="map_2"></div>			
		</div>
		
		<div id="references" class="section reveal">
			<h3>References</h3>
			<ul style="font-size: 10pt;">
				<li>Badgley et al. (2017). Canopy near-infrared reflectance and terrestrial photosynthesis, Science, <a target="_blank" href="https://doi.org/10.1126/sciadv.1602244">https://doi.org/10.1126/sciadv.1602244</a></li>
				<li>Beer et al. (2010), Terrestrial Gross Carbon Dioxide Uptake: Global Distribution and Covariation with Climate, Science, <a target="_blank" href="https://doi.org/10.1126/science.1184984">https://doi.org/10.1126/science.1184984</a></li>
				<li>Betts, R., Jones, C., Knight, J. et al. El Niño and a record CO<sub>2</sub> rise. Nature Clim Change 6, 806–810 (2016). <a target="_blank" href="https://doi.org/10.1038/nclimate3063">https://doi.org/10.1038/nclimate3063</a></li>
				<li>Butt, E. W., Conibear, L., Smith, C., Baker, J. C. A., Rigby, R., Knote, C., & Spracklen, D. V. (2022). Achieving Brazil's deforestation target will reduce fire and deliver air quality and public health benefits. Earth's Future, 10, e2022EF003048. <a target="_blank" href="https://doi.org/10.1029/2022EF003048">https://doi.org/10.1029/2022EF003048</a></li>
				<li>de Almeida Castanho, A. D., Galbraith, D., Zhang, K., Coe, M. T., Costa, M. H., and Moorcroft, P. (2016), Changing Amazon biomass and the role of atmospheric CO<sub>2</sub> concentration, climate, and land use, Global Biogeochem. Cycles, 30, 18– 39, <a target="_blank" href="https://doi.org/10.1002/2015GB005135">https://doi.org/10.1002/2015GB005135</a></li>
				<li>Duffy et al. (2015), Projections of future meteorological drought and wet periods in the Amazon, PNAS, <a target="_blank" href="https://doi.org/10.1073/pnas.1421010112">https://doi.org/10.1073/pnas.1421010112</a></li>
				<li>Fearnside, P.M. (2015). Highway Construction as a Force in the Destruction of the Amazon Forest. In Handbook of Road Ecology (eds R. van der Ree, D.J. Smith and C. Grilo). <a target="_blank" href="https://doi.org/10.1002/9781118568170.ch51">https://doi.org/10.1002/9781118568170.ch51</a></li>
				<li>Flores, B. M., & Staal, A. (2022). Feedback in tropical forests of the Anthropocene. Global Change Biology, 28, 5041– 5061. <a target="_blank" href="https://doi.org/10.1111/gcb.16293">https://doi.org/10.1111/gcb.16293</a></li>
				<li>Gatti, L.V., Basso, L.S., Miller, J.B. et al. Amazonia as a carbon source linked to deforestation and climate change. Nature 595, 388–393 (2021). <a target="_blank" href="https://doi.org/10.1038/s41586-021-03629-6">https://doi.org/10.1038/s41586-021-03629-6</a></li>
				<li>Hersbach, H, Bell, B, Berrisford, P, et al. The ERA5 global reanalysis. Q J R Meteorol Soc. 2020; 146: 1999– 2049. <a target="_blank" href="https://doi.org/10.1002/qj.3803">https://doi.org/10.1002/qj.3803</a></li>
				<li>Kemenes, A., Forsberg, B. R., and Melack, J. M. (2011), CO<sub>2</sub> emissions from a tropical hydroelectric reservoir (Balbina, Brazil), J. Geophys. Res., 116, G03004, <a target="_blank" href="https://doi.org/10.1029/2010JG001465">https://doi.org/10.1029/2010JG001465</a></li>
				<li>Koren et al. (2018). Widespread reduction in sun-induced fluorescence from the Amazon during the 2015/2016 El Niño. Philosophical Transactions of the Royal Society B: Biological Sciences. <a target="_blank" href="https://doi.org/10.1098/rstb.2017.0408">https://doi.org/10.1098/rstb.2017.0408</a></li>
				<li>Morton et al. (2006), Cropland expansion changes deforestation dynamics in the southern Brazilian Amazon, PNAS, <a target="_blank" href="https://doi.org/10.1073/pnas.0606377103">https://doi.org/10.1073/pnas.0606377103</a></li>
				<li>Naus et al. (2022). Sixteen years of MOPITT satellite data strongly constrain Amazon CO fire emissions. Atmospheric Chemistry and Physics. <a target="_blank" href="https://doi.org/10.5194/acp-22-14735-2022">https://doi.org/10.5194/acp-22-14735-2022</a></li>
				<li>Pendrill et al (2022), Disentangling the numbers behind agriculture-driven tropical deforestation, <a target="_blank" href="https://dio.org/10.1126/science.abm9267">https://dio.org/10.1126/science.abm9267</a></li>
				<li>Rap, A., Spracklen, D. V., Mercado, L., Reddington, C. L., Haywood, J. M., Ellis, R. J., Phillips, O. L., Artaxo, P., Bonal, D., Restrepo Coupe, N., and Butt, N. (2015), Fires increase Amazon forest productivity through increases in diffuse radiation. Geophys. Res. Lett., 42, 4654– 4662. <a target="_blank" href="https://doi.org/10.1002/2015GL063719 ">https://doi.org/10.1002/2015GL063719</a></li>
				<li>Rodrigues et al. (2009). Boom-and-Bust Development Patterns Across the Amazon Deforestation Frontier. Science. <a target="_blank" href="https://doi.org/10.1126/science.1174002">https://doi.org/10.1126/science.1174002</a></li>
				<li>Saatchi et al. (2011), Benchmark map of forest carbon stocks in tropical regions across three continents, PNAS, <a target="_blank" href="https://doi.org/10.1073/pnas.1019576108">https://doi.org/10.1073/pnas.1019576108</a></li>
				<li>Schaaf, C. & Wang, Z. (2015). MCD43C4 MODIS/Terra+Aqua BRDF/Albedo Nadir BRDF-Adjusted Ref Daily L3 Global 0.05Deg CMG V006 [Data set]. NASA EOSDIS Land Processes DAAC. <a target="_blank" href="https://doi.org/10.5067/MODIS/MCD43C4.006">https://doi.org/10.5067/MODIS/MCD43C4.006</a></li>
				<li>Schöngart, J, Wittmann, F, Faria de Resende, A, et al. The shadow of the Balbina dam: A synthesis of over 35 years of downstream impacts on floodplain forests in Central Amazonia. Aquatic Conserv: Mar Freshw Ecosyst. 2021; 31: 1117– 1135. <a target="_blank" href="https://doi.org/10.1002/aqc.3526">https://doi.org/10.1002/aqc.3526</a> </li>
				<li>Silva, S. N. R., Cirino, G., Soares Moreira, D., et al. (2023). Enhanced net CO<sub>2</sub> exchange of a semi-deciduous forest in the southern Amazon due to diffuse radiation from biomass burning. ESS Open Archive. <a target="_blank" href="https://doi.org/10.22541/essoar.167390530.08313869/v1">https://doi.org/10.22541/essoar.167390530.08313869/v1</a></li>
				<li>Smith, C., Baker, J.C.A. & Spracklen, D.V. Tropical deforestation causes large reductions in observed precipitation. Nature 615, 270–275 (2023). <a target="_blank" href="https://doi.org/10.1038/s41586-022-05690-1">https://doi.org/10.1038/s41586-022-05690-1</a></li>
				<li>van der Ent, R. J., Savenije, H. H. G., Schaefli, B., and Steele-Dunne, S. C. (2010), Origin and fate of atmospheric moisture over continents, Water Resour. Res., 46, W09525, <a target="_blank" href="https://doi.org/10.1029/2010WR009127">https://doi.org/10.1029/2010WR009127</a></li>
				<li>Van Nes E H, Staal A, Hantson S, Holmgren M, Pueyo S, Bernardi R E, Flores B M, Xu C and Scheffer M 2018 Fire forbids fifty-fifty forest PLoS ONE 18 e0191027 <a target="_blank" href="https://doi.org/10.1371/journal.pone.0191027">https://doi.org/10.1371/journal.pone.0191027</a></li>
				<li>van Schaik et al. (2018). Changes in surface hydrology, soil moisture and gross primary production in the Amazon during the 2015/2016 El Niño. Philosophical Transactions of the Royal Society B: Biological Sciences. <a target="_blank" href="https://doi.org/10.1098/rstb.2018.0084">https://doi.org/10.1098/rstb.2018.0084</a></li>
				<li>Zemp, D., Schleussner, CF., Barbosa, H. et al. Self-amplified Amazon forest loss due to vegetation-atmosphere feedbacks. Nat Commun 8, 14681 (2017). <a target="_blank" href="https://doi.org/10.1038/ncomms14681">https://doi.org/10.1038/ncomms14681</a></li>				
			</ul>
		</div>
				
		<div id="footer">
			<div>We acknowledge Utrecht University for providing resources to develop this project as part of the Bright Mind Assistantship program</div>
			<div>Lola Varga, Gerbrand Koren;  2023</div>
			<!-- ANY PLUS INFO, NAMES, ETC. INTO THIS NEXT DIV, UNCOMMENTED: -->
			<!-- <div></div> -->
		</div>
		
		
		<script>
		
			// Juxtapose JS slider
			slider = new juxtapose.JXSlider('#juxtapose_wrap',
				[
					{
						src: 'https://github.com/vargalola/deforestation/raw/main/before_defores.png',
						label: 'December 2001',
						credit: ''
					},
					{
						src: 'https://github.com/vargalola/deforestation/raw/main/after_defores.png',
						label: 'December 2021',
						credit: ''
					}
				],
				{
					animate: true,
					showLabels: true,
					showCredits: true,
					startingPosition: "50%",
					makeResponsive: true
				});
		
			// Scroll reveal animation: https://alvarotrigo.com/blog/css-animations-scroll/
			function reveal() {
			  var reveals = document.querySelectorAll(".reveal");
			  for (var i = 0; i < reveals.length; i++) {
				var windowHeight = window.innerHeight;
				var elementTop = reveals[i].getBoundingClientRect().top;
				var elementVisible = 10;
				if (elementTop < windowHeight - elementVisible) {
				  reveals[i].classList.add("active");
				} else {
				  reveals[i].classList.remove("active");
				}
			  }
			}
			
			window.addEventListener("scroll", reveal);

			// To check the scroll position on page load
			reveal();
			
			function areatokm2(value) {
				result = value/1000000
				return result
			}
			
			function tooltip_deforestation(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>Deforestation: " + layer.feature.properties.deforestation_average_deforestation_average.toFixed(2) + " %</div>";
			}
			function tooltip_nirv(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>NIRv: " + layer.feature.properties.nirv_average_Average.toFixed(3) + "</div>";
			}
			function tooltip_precip(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>Precipitation: " + layer.feature.properties.precip_by_states_2001_2019_VAL.toFixed(3) + "</div>";
			}
			function tooltip_population(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>Population density: " + layer.feature.properties.population_average_population_average.toLocaleString() + " / km >2</sup></div>";
			}
			function tooltip_gdp(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>GDP (R$ 1 billion): " + layer.feature.properties.gdp_average_gdp_average + "</div>";
			}		
			
			function stilus_deforestation(feature){
				var p = feature.properties;
				
				if (p.deforestation_average_deforestation_average > 8.0900) {
					return {
						fillColor: '#a50f15'
					}
				} else if (p.deforestation_average_deforestation_average > 5.9100){
					return {
						fillColor: '#de2d26'
					};
				} else if (p.deforestation_average_deforestation_average > 2.4000){
					return {
						fillColor: '#fb6a4a'
					};
				} else if (p.deforestation_average_deforestation_average > 0.6701){
					return {
						fillColor: '#fc9272'
					};
				} else {
					return {
						fillColor: '#fcbba1'
					};
				}
			} 
			
			function stilus_nirv(feature){
				var p = feature.properties;
				
				if (p.nirv_average_Average > 0.24327) {
					return {
						fillColor: '#000c00'
					}
				} else if (p.nirv_average_Average > 0.22448){
					return {
						fillColor: '#004000'
					};
				} else if (p.nirv_average_Average > 0.20270){
					return {
						fillColor: '#008000'
					};
				} else if (p.nirv_average_Average > 0.15989){
					return {
						fillColor: '#7fbf7f'
					};
				} else {
					return {
						fillColor: '#e5f2e5'
					};
				}
			}
			
			function stilus_precip(feature){
				var p = feature.properties;
				
				if (p.precip_by_states_2001_2019_VAL > 7.0007) {
					return {
						color: '#beeb1d'
					}
				} else if (p.precip_by_states_2001_2019_VAL > 5.0864){
					return {
						color: '#d1ff00'
					};
				} else if (p.precip_by_states_2001_2019_VAL > 4.0013){
					return {
						color: '#d9ff00'
					};
				} else if (p.precip_by_states_2001_2019_VAL > 3.2645){
					return {
						color: '#f6f43e'
					};
				} else {
					return {
						color: '#feff63'
					};
				}
			}
			
			function stilus_population(feature){
				var p = feature.properties;
				
				if (p.population_average_population_average > 6.180) {
					return {
						fillColor: '#a63603'
					}
				} else if (p.population_average_population_average > 4.790){
					return {
						fillColor: '#e6550d'
					};
				} else if (p.population_average_population_average > 3.210){
					return {
						fillColor: '#fd8d3c'
					};
				} else if (p.population_average_population_average > 1.911){
					return {
						fillColor: '#fdbe85'
					};
				} else {
					return {
						fillColor: '#feedde'
					};
				}
			}
			
			function stilus_gdp(feature){
				var p = feature.properties;
				
				if (p.gdp_average_gdp_average > 98.75) {
					return {
						fillColor: '#54278f'
					}
				} else if (p.gdp_average_gdp_average > 72.12){
					return {
						fillColor: '#756bb1'
					};
				} else if (p.gdp_average_gdp_average > 26.25){
					return {
						fillColor: '#9e9ac8'
					};
				} else if (p.gdp_average_gdp_average > 9.75){
					return {
						fillColor: '#cbc9e2'
					};
				} else {
					return {
						fillColor: '#f2f0f7'
					};
				}
			}
			
			function stilus_slope(feature){
				var p = feature.properties;
				
				if (p.slope_slope == "y = -149.26x + 1623.8") {
					return {
						fillColor: '#2166ac'
					}
				} else if (p.slope_slope == "y = -82.858x + 932.84"){
					return {
						fillColor: '#2166ac'
					};
				} else if (p.slope_slope == "y = -27.99x + 329.07"){
					return {
						fillColor: '#67a9cf'
					};
				} else if (p.slope_slope == "y = -23.818x + 250.64"){
					return {
						fillColor: '#67a9cf'
					};
				} else if (p.slope_slope == "y = -11.405x + 112.21"){
					return {
						fillColor: '#d1e5f0'
					};
				} else if (p.slope_slope == "y = -10.846x + 82.289"){
				 	return {
						fillColor: '#d1e5f0'
					};
				} else if (p.slope_slope == "y = -1.9731x + 33.534"){
					return {
						fillColor: '#f7f7f7'
					};
				} else if (p.slope_slope == "y = 3.8565x + 32.91"){
					return {
						fillColor: '#fddbc7'
					};
				} else if (p.slope_slope == "y = 4.0917x - 2.8023"){
					return {
						fillColor: '#fddbc7'
					};
				} else {
					return {
						fillColor: '#000000'
					};
				}
			}
			
			function stilus_r2(feature){
				var p = feature.properties;
				
				if (p.correlation_r2_values_leaflet_r2 > 0.8) {
					return {
						fillColor: '#7a0177'
					}
				} else if (p.correlation_r2_values_leaflet_r2 > 0.38){
					return {
						fillColor: '#c51b8a'
					};
				} else if (p.correlation_r2_values_leaflet_r2 > 0.201){
					return {
						fillColor: '#f768a1'
					};
				} else if (p.correlation_r2_values_leaflet_r2 > 0.02){
					return {
						fillColor: '#fbb4b9'
					};
				} else {
					return {
						fillColor: '#feebe2'
					};
				}
			}
			
			function mousehighlight (feature, layer) {
					// when hover over the feature, highlight it
					layer.on('mouseover', function () {
						this.setStyle({
							'weight': '6',
							'fillOpacity': '1',
							'border-width': '0.5',
						});
					});
					// when we go off the feature, return to default style
					layer.on('mouseout', function () {
						this.setStyle({
							'weight': '2',
							'fillOpacity': '0.7'
							
						});
					});
				}
				
				
			// map div object, main Leaflet object:
			var map = L.map('map',{maxBounds: L.latLngBounds(L.latLng(-29.935789, -94.974456), L.latLng(22.153948, -27.264859)),
									maxBoundsViscosity: 1.0,
									minZoom: 3
									}); 
			map.addControl(new L.Control.Fullscreen());
			map.scrollWheelZoom.disable();
			
			// base maps
			var OSM = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; <a target="_blank" href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(map);
			
			// overlays			
			var x=new XMLHttpRequest();
			x.open('get', 'data/main_map_2.geojson', false);
			x.send();
			var d=JSON.parse(x.responseText);
			var mainmap_deforestation = L.geoJSON(d,{style: stilus_deforestation, onEachFeature: mousehighlight, color: 'white', weight: 2, fillOpacity: 0.7}).bindTooltip(tooltip_deforestation);
				mainmap_deforestation.getAttribution = function() { return 'TerraBrasilis: DETER dataset'; };
			var mainmap_population = L.geoJSON(d,{style: stilus_population, onEachFeature: mousehighlight, color: 'white', weight: 2, fillOpacity: 0.7}).bindTooltip(tooltip_population);
				mainmap_population.getAttribution = function() { return 'Instituto Brasileiro de Geografia e Estatística - IBGE'; };
			var mainmap_gdp = L.geoJSON(d,{style: stilus_gdp, onEachFeature: mousehighlight, color: 'white', weight: 2, fillOpacity: 0.7}).bindTooltip(tooltip_gdp);
				mainmap_gdp.getAttribution = function() { return 'Instituto Brasileiro de Geografia e Estatística - IBGE'; };
			
			// we add the default layer to map to show when page is opened:
			mainmap_deforestation.addTo(map)
			map.fitBounds(mainmap_deforestation.getBounds());
			
			// list of overlays
			var overlayMaps = {
				"Deforestation": mainmap_deforestation,
				"Population density": mainmap_population,
				"GDP": mainmap_gdp
			};
			
			var layerControl = L.control.layers(overlayMaps, null, {collapsed:false}).addTo(map); 
			
			var tifftooltip_nirv;
			var tifftooltip_precip;
			
			
			// HIGHCHARTS - DEPENDENCY WHEEL:
			Highcharts.chart('container', {
				chart: {
					/*width: 700*/
				},
				title: {
					text: 'Correlation among social and natural factors'
				},				
				subtitle: {
					text: 'Feedbacks and Interactions'
				},
				// tooltip lower row format
				tooltip: {
					//pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
					//pointFormat: '{index}. From {point.from} to {point.to}: {point.weight} {point.mas}'
					//pointFormat: '<b>{point.from}</b> ➤ <b>{point.to}</b><br><br>{point.description}'
					pointFormat: '<b>{point.from}</b> ➤ <b>{point.to}</b>'
				},				
				accessibility: {
					point: {
						valueDescriptionFormat: '{point.description}'
					}
				},
				series: [{
					type: 'dependencywheel',
					name: 'Relation', 				// appears on top of tooltip, indicating the series name
					cursor: 'pointer',								// make cursor a pointer cursor when hovering over the chart
					keys: ['from', 'to', 'weight', 'description', 'source'],
					nodes: [{
						id: 'Deforestation and Fires',
						color: "#fc6b4e"
					}, {
						id: 'Energy and Transport<br>infrastructure',
						color: "#f7cb45"
					}, {
						id: 'Human Health<br>and Wellbeing',
						color: "#77c3dd"
					}, {
						id: 'Agriculture<br>Timber',
						color: "#c38d54"
					}, {
						id: 'Atmospheric CO<sub>2</sub> and Climate Change',
						color: "#8c8c8c"
					}, {
						id: 'Droughts and Moisture Recycling',
						color: "#3d85c6"
					}, {
						id: 'Photosynthesis and Carbon Sequestration',
						color: "#5df745"
					}, {
						id: 'Forest<br>Biodiversity',
						color: "#6aa84f"
					}],
					data: [
						['Deforestation and Fires', 'Human Health<br>and Wellbeing', 1, "Deforestation can lead to economic and societal gains in the short term, as expressed by the Human Development Index (e.g. Rodrigues et al., 2009), but lead to the opposite effects over a longer time period. Fires release particles in the atmosphere that are damaging to human health (e.g., Butt et al. 2022)<br><br>Butt, E. W., Conibear, L., Smith, C., Baker, J. C. A., Rigby, R., Knote, C., & Spracklen, D. V. (2022). Achieving Brazil's deforestation target will reduce fire and deliver air quality and public health benefits. Earth's Future, 10, e2022EF003048. https://doi.org/10.1029/2022EF003048<br><br>Rodrigues et al. (2009). Boom-and-Bust Development Patterns Across the Amazon Deforestation Frontier. Science. https://doi.org/10.1126/science.1174002", "https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data"],
						['Deforestation and Fires', 'Photosynthesis and Carbon Sequestration', 1, "Aerosols and smoke from fires leads to a larger fraction of diffuse radiation, which can stimulate photosynthetic uptake (Rap et al., 2015; Silva et al., 2023)<br><br>Rap, A., Spracklen, D. V., Mercado, L., Reddington, C. L., Haywood, J. M., Ellis, R. J., Phillips, O. L., Artaxo, P., Bonal, D., Restrepo Coupe, N., and Butt, N. (2015), Fires increase Amazon forest productivity through increases in diffuse radiation. Geophys. Res. Lett., 42, 4654– 4662. https://doi.org/10.1002/2015GL063719<br><br>Silva, S. N. R., Cirino, G., Soares Moreira, D., et al. (2023). Enhanced net CO2 exchange of a semi-deciduous forest in the southern Amazon due to diffuse radiation from biomass burning. ESS Open Archive. https://doi.org/10.22541/essoar.167390530.08313869/v1", 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['Deforestation and Fires', 'Atmospheric CO<sub>2</sub> and Climate Change', 1, "Fires emit carbon dioxide which accumulates in the atmosphere. Emission can be directly in the form of CO2, or indirectly in the form of CO, which later oxidizes in the atmosphere to form CO2 (Naus et al., 2022)<br><br>Naus et al. (2022). Sixteen years of MOPITT satellite data strongly constrain Amazon CO fire emissions. Atmospheric Chemistry and Physics. https://doi.org/10.5194/acp-22-14735-2022", 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['Deforestation and Fires', 'Droughts and Moisture Recycling', 1, "Deforestation leads to a reduction of transpiration of water. This reduces the moisture that can be recycled (e.g. van der Ent et al., 2010), leading to reductions in precipitation (Zemp et al., 2017, Smith et al., 2023)<br><br>Smith, C., Baker, J.C.A. & Spracklen, D.V. Tropical deforestation causes large reductions in observed precipitation. Nature 615, 270–275 (2023). https://doi.org/10.1038/s41586-022-05690-1<br><br>van der Ent, R. J., Savenije, H. H. G., Schaefli, B., and Steele-Dunne, S. C. (2010), Origin and fate of atmospheric moisture over continents, Water Resour. Res., 46, W09525, https://doi.org/10.1029/2010WR009127<br><br>Zemp, D., Schleussner, CF., Barbosa, H. et al. Self-amplified Amazon forest loss due to vegetation-atmosphere feedbacks. Nat Commun 8, 14681 (2017). https://doi.org/10.1038/ncomms14681", 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['Energy and Transport<br>infrastructure', 'Deforestation and Fires', 1, "Deforestation is needed for the construction of highways through the Amazon (Fearnside, 2015), but also enables more deforestation by providing access to the forest for heavy equipment. Dam construction also necessitates clearing of forests and affects the remaining forest by e.g. casting shadows.<br><br>Fearnside, P.M. (2015). Highway Construction as a Force in the Destruction of the Amazon Forest. In Handbook of Road Ecology (eds R. van der Ree, D.J. Smith and C. Grilo). https://doi.org/10.1002/9781118568170.ch51<br><br>Schöngart, J, Wittmann, F, Faria de Resende, A, et al. The shadow of the Balbina dam: A synthesis of over 35 years of downstream impacts on floodplain forests in Central Amazonia. Aquatic Conserv: Mar Freshw Ecosyst. 2021; 31: 1117– 1135. https://doi.org/10.1002/aqc.3526", 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['Energy and Transport<br>infrastructure', 'Atmospheric CO<sub>2</sub> and Climate Change', 1, "Economic development is often associated with fossil fuel combustion and release of CO2 into the atmosphere. The atmospheric concentration over the Amazon is the result of atmospheric mixing and accumulation of global emissions since the start of the industrial revolution (e.g. Betts et al 2016). Also the large Bablina hydrodam in the Amazon results in significant CO2 emissions (Kemenes et al., 2011)<br><br>Betts, R., Jones, C., Knight, J. et al. El Niño and a record CO2 rise. Nature Clim Change 6, 806–810 (2016). https://doi.org/10.1038/nclimate3063 <br><br>Kemenes, A., Forsberg, B. R., and Melack, J. M. (2011), CO2 emissions from a tropical hydroelectric reservoir (Balbina, Brazil), J. Geophys. Res., 116, G03004, https://doi.org/10.1029/2010JG001465", 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['Agriculture<br>Timber', 'Deforestation and Fires', 1, "Agriculture requires fertile soils and is one of the human drivers of deforestation (Morton et al, 2006) and was identified as the main driver for deforestation (Pendrill et al., 2022). Also, the extraction of trees for timber production is an important driver for deforestation.<br><br>Morton et al. (2006), Cropland expansion changes deforestation dynamics in the southern Brazilian Amazon, PNAS, https://doi.org/10.1073/pnas.0606377103<br><br>Pendrill et al (2022), Disentangling the numbers behind agriculture-driven tropical deforestation, https://dio.org/10.1126/science.abm9267 ", 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['Atmospheric CO<sub>2</sub> and Climate Change', 'Photosynthesis and Carbon Sequestration', 1, "Elevated CO2 concentrations can lead to higher photosynthesis rates e.g. de Almeida Castanho et al. (2016) through CO2 fertilization.<br><br>de Almeida Castanho, A. D., Galbraith, D., Zhang, K., Coe, M. T., Costa, M. H., and Moorcroft, P. (2016), Changing Amazon biomass and the role of atmospheric CO2 concentration, climate, and land use, Global Biogeochem. Cycles, 30, 18– 39, https://doi.org/10.1002/2015GB005135", 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['Atmospheric CO<sub>2</sub> and Climate Change', 'Droughts and Moisture Recycling', 1, "Due to climate change, the frequency of droughts is increasing (Duffy et al., 2015) and the dry season has become warmer (Gatti et al., 2021)<br><br>Duffy et al. (2015), Projections of future meteorological drought and wet periods in the Amazon, PNAS, https://doi.org/10.1073/pnas.1421010112<br><br>Gatti, L.V., Basso, L.S., Miller, J.B. et al. Amazonia as a carbon source linked to deforestation and climate change. Nature 595, 388–393 (2021). https://doi.org/10.1038/s41586-021-03629-6 ", 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['Droughts and Moisture Recycling', 'Photosynthesis and Carbon Sequestration', 1, "When vegetation is moisture-limited, the plants will experience stress in case the supply of water is reduced, or when the demand for moisture is increased. Although rain forests are usually wet, severe droughts can lead to stressed vegetation and reduced carbon uptake, as was e.g. witnessed during the severe drought during the 2015/16 El Nino (Koren et al, van Schaik et al)<br><br>Koren et al. (2018). Widespread reduction in sun-induced fluorescence from the Amazon during the 2015/2016 El Niño. Philosophical Transactions of the Royal Society B: Biological Sciences. https://doi.org/10.1098/rstb.2017.0408<br><br>van Schaik et al. (2018). Changes in surface hydrology, soil moisture and gross primary production in the Amazon during the 2015/2016 El Niño. Philosophical Transactions of the Royal Society B: Biological Sciences. https://doi.org/10.1098/rstb.2018.0084", 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['Photosynthesis and Carbon Sequestration', 'Atmospheric CO<sub>2</sub> and Climate Change', 1, "Photosynthesis removes CO2 from the atmosphere. Photosynthesis rates in tropical forests are high (Beer et al., 2010) and the forests contain large amounts of aboveground biomass (Saatchi et al., 2011).<br><br>Beer et al. (2010), Terrestrial Gross Carbon Dioxide Uptake: Global Distribution and Covariation with Climate, Science, https://doi.org/10.1126/science.1184984<br><br>Saatchi et al. (2011), Benchmark map of forest carbon stocks in tropical regions across three continents, PNAS, https://doi.org/10.1073/pnas.1019576108 ", 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['Forest<br>Biodiversity', 'Deforestation and Fires', 1, "The forest structure is one of the determinants for the susceptibility of the forest to fires (Van Nes et al., 2018)<br><br>Van Nes E H, Staal A, Hantson S, Holmgren M, Pueyo S, Bernardi R E, Flores B M, Xu C and Scheffer M 2018 Fire forbids fifty-fifty forest PLoS ONE 18 e0191027 https://doi.org/10.1371/journal.pone.0191027 ", 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
					],
					dataLabels: {
						color: '#333',
						style: {
							textOutline: 'none'
						},
						textPath: {
							enabled: true
						},
						distance: 25
					},
					size: '90%',
					events: {
						/* click: function (event) {
							// on click of a relation, open the reference URL (paper, literature) from field "source", if it exists:
							if (event.point.source != null) {
								window.open(event.point.source, "_blank");
							}
						},*/
					}
				}]			
			});
			

			setLegend('Deforestation (%)', [(8.09).toFixed(2), (3.63).toFixed(2), (1.23).toFixed(2), (0.5).toFixed(2)], ['#a50f15', '#de2d26', '#fb6a4a', '#fcae91', '#fee5d9']);	
			
			// STATIC MAP: LEGEND for values
			function setLegend(title, values, colors){
				legend_mainmap = L.control({position: 'bottomright'});
				legend_mainmap.onAdd = function(map) {
					var div = L.DomUtil.create("div");
					var content = '<div id="legenddiv" class="leaflet-bar custom-control legend">';
						content += '<div class="legendcolumnlist">';
							content += '<div class="legenditem" style="justify-content: center;">';
								content += '<span style="">'+title+'</span>';
							content += '</div>';
							content += '<div class="legenditem">';
								content += '<div style="background-color: '+colors[0]+'; width: 27px; height: 16px; margin-right: 5px;"></div>';
								content += '<span>'+values[0]+' < </span>';
							content += '</div>';
							content += '<div class="legenditem">';
								content += '<div style="background-color: '+colors[1]+'; width: 27px; height: 16px; margin-right: 5px;"></div>';
								content += '<span>'+values[1]+' - '+values[0]+'</span>';
							content += '</div>';
							content += '<div class="legenditem">';
								content += '<div style="background-color: '+colors[2]+'; width: 27px; height: 16px; margin-right: 5px;"></div>';
								content += '<span>'+values[2]+' - '+values[1]+'</span>';
							content += '</div>';
							content += '<div class="legenditem">';
								content += '<div style="background-color: '+colors[3]+'; width: 27px; height: 16px; margin-right: 5px;"></div>';
								content += '<span>'+values[3]+' - '+values[2]+'</span>';
							content += '</div>';
							content += '<div class="legenditem">';
								content += '<div style="background-color: '+colors[4]+'; width: 27px; height: 16px; margin-right: 5px;"></div>';
								content += '<span> > '+values[3]+'</span>';
							content += '</div>';
						content += '</div>';
					content += '</div>';
					
					div.innerHTML = content;
					  
					return div;
					
				};
				legend_mainmap.addTo(map);
			};
			
			// STATIC MAP: LEGEND for GRADIENTS
			function setLegend_gradient(values, unit, colors, targetmap){
				legend_mainmap = L.control({position: 'bottomright'});
				legend_mainmap.onAdd = function(map) {
				
				function colorcount(){
						var result = "";
						for (var i = 0; i<colors.length; i++) { result = result + colors[i] + ", " }
						result = result.slice(0, -2);
						return result;						
					}		
				
					var div = L.DomUtil.create("div");
					var content = '<div id="legenddiv" class="leaflet-bar custom-control legend">';
						content += '<div style="display: flex; flex-direction: column; margin-top: 4px; width: 130px;">';
							content += '<div style="background: linear-gradient(to right, '+colorcount()+') ; width: 100%; height: 14px;"></div>';
							content += '<div style="display: flex; flex-direction: row; justify-content: space-between;"><span>'+values[0]+'</span><span>'+values[1]+'</span></div><div style="display: flex; flex-direction: row; justify-content: center;">'+unit+'</div>';
						content += '</div>';
					content += '</div>';
					 
					div.innerHTML = content;
					  
					return div;
					
				};
				legend_mainmap.addTo(map);
			};
			
			
			map.on('baselayerchange', function (e) {
				map.removeControl(legend_mainmap);
				if (e.name === 'Deforestation') {
					setLegend('Deforestation (%)', [8.0892.toFixed(2), 3.6333.toFixed(2), 1.2308.toFixed(2), 0.4993.toFixed(2)], ['#a50f15', '#de2d26', '#fb6a4a', '#fcae91', '#fee5d9']);
				}  else if (e.name === 'Population density') {
					setLegend('Population density (per km<sup>2</sup>)', [parseFloat(6.180).toLocaleString(), parseFloat(4.790).toLocaleString(), parseFloat(3.210).toLocaleString(), parseFloat(1.910).toLocaleString()], ['#a63603', '#e6550d', '#fd8d3c', '#fdbe85', '#feedde']);
				} else if (e.name === 'GDP') {
					setLegend('GDP (R$ 1 billion)', [98.75, 72.75, 26.25, 9.75], ['#54278f', '#756bb1', '#9e9ac8', '#cbc9e2', '#f2f0f7']);
				} else if (e.name === 'NIRv') {
					setLegend_gradient([-0.082, 0.332], '', chroma.scale(['white', 'green']).colors(2), map); // first param is labels: [mix, max], second param is the colors from-to (min, then max)
				} else if (e.name === 'Precipitation') {
					setLegend_gradient([0, parseFloat(0.0616789758*1000).toFixed(3)], 'mm/day', chroma.scale(['red', 'orange', 'yellow', 'green', 'cyan', 'blue']).colors(5), map); // first param is labels: [mix, max], second param is the colors from-to (min, then max)
				} 
			});
			
			/////////////////////////////////
			// DYNAMIC DATA, ANIMATED MAP: //
			/////////////////////////////////
			
			var dynamic_currentlayer;
			
			// map div 2, for dynamic data 
			var map_dynamic = L.map('map_dynamic', {maxBounds: L.latLngBounds(L.latLng(-30, -90), L.latLng(15, -30)),
									maxBoundsViscosity: 1.0,
									minZoom: 3
									}).setView([-5,-60], 4);
			map_dynamic.addControl(new L.Control.Fullscreen());			
			map_dynamic.scrollWheelZoom.disable();
			
			var OSM = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; <a target="_blank" href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(map_dynamic);
			
			// SLIDER BUTTON PANEL
			var buttonpanelControl = L.control({position: 'bottomleft'});
			buttonpanelControl.onAdd = function () {
				  var div = L.DomUtil.create('div');
				  div.innerHTML = '<div class="leaflet-bar custom-control cc_bmargin" style="display: flex; flex-direction: column; align-items: center; min-width: 200px; margin-bottom: 16px;"><div style="width: 100%; display: flex; justify-content: center;">2001-2021 (monthly mean)</div><div style="display: flex; flex-direction: row; align-items: center; justify-content: space-around; width: 100%;">						<span id="month" style="width: 20%;"> </span> <div><input id="loopcheckbox" name="loopcheckbox" type="checkbox" checked>						<label for="loopcheckbox">Loop</label></div><input type="button" value="Start" onclick="startStop(this)" />						</div><input id="monthslider" type="range" min="1" max="12" oninput="datumBeall(this.value)" style=""/></div>';	
				  
					L.DomEvent.disableClickPropagation(div);
				  return div;
			};
			buttonpanelControl.addTo(map_dynamic);			
			buttonpanelControl.getContainer().addEventListener('mouseover', function () {
				map_dynamic.dragging.disable();
			});
			buttonpanelControl.getContainer().addEventListener('mouseout', function () {
				map_dynamic.dragging.enable();
			});
					
			map_dynamic.on('baselayerchange', function (e) {
				map.removeControl(legend_dyn);
				if (e.name === 'Precipitation') {
					if (layerNirv != null) {
						layerNirv.hide();
					}
					dynamic_currentlayer = "precip";
					loadTiffPrecip('data/meanmonths/precip_'+String(month).padStart(2, '0')+'.tif', true);
					setLegend_gradient_dynamic([0, 0.085*1000], 'mm/day', chroma.scale(['rgba(0,0,0,0)','rgba(0,0,255,0.5)', 'rgba(0,0,255,0.6)', 'rgba(0,0,255,0.7)' , 'rgba(0,0,255,0.82)' , 'blue']).colors(6), map_dynamic);
				} else if (e.name === 'NIRv') {
					/*if (layerPrecip != null) {
						layerPrecip.hide();
					}*/
					dynamic_currentlayer = "nirv";
					loadTiffNirv('data/nirv_months/nirv_'+String(month).padStart(2, '0')+'.tif', true);
					setLegend_gradient_dynamic([0, 0.3755], '', chroma.scale(['rgba(0,0,0,0)','rgba(0,100,0,0.2)', 'rgba(0,100,0,0.4)', 'rgba(0,100,0,0.6)' , 'rgba(0,100,0,0.82)' , 'darkgreen']).colors(6), map_dynamic);
				}
			});
			
			// DYNAMIC MAP: LEGEND for GRADIENTS
			function setLegend_gradient_dynamic(values, unit, colors, targetmap){
				legend_dyn = L.control({position: 'bottomright'});
				legend_dyn.onAdd = function(map_dynamic) {
					var div = L.DomUtil.create("div");
					var content = '<div id="legenddiv" class="leaflet-bar custom-control legend">';
						content += '<div style="display: flex; flex-direction: column; margin-top: 4px; width: 130px;">';
							content += '<div style="background: linear-gradient(to right, '+colors[0]+', '+colors[colors.length-1]+'); width: 100%; height: 14px;"></div>';
							content += '<div style="display: flex; flex-direction: row; justify-content: space-between;"><span>'+values[0]+'</span><span>'+values[1]+'</span></div><div style="display: flex; flex-direction: row; justify-content: center;">'+unit+'</div>';
						content += '</div>';
					content += '</div>';
					 
					div.innerHTML = content;
					  
					return div;
					
				};
				legend_dyn.addTo(map_dynamic);
			};
			
			var month = 1;
			document.getElementById('month').innerHTML=swapMonthNumberwithName(month);
			document.getElementById('monthslider').value=month;
			
			var x=new XMLHttpRequest();
			x.open('get', 'data/main_map_2.geojson', false);
			x.send();
			var d=JSON.parse(x.responseText);
			var dynamicmap_stateborders = L.geoJSON(d, {style: function (feature) { return {color: "#ffffff", weight: 2, fill: false} }, onEachFeature: function (feature, layer) {
				layer.bindTooltip(feature.properties.sigla, {permanent: true, direction:"center"});} });
				dynamicmap_stateborders.getAttribution = function() { return 'TerraBrasilis'; };
			dynamicmap_stateborders.addTo(map_dynamic)			
											
							
			// GeoTIFF in dynamic map
			var layerPrecip;
			var layerNirv;
			var tifftooltip_precip;
			var layerControl_dynamic;
			var precip_range;
			
			var overlayMaps_dynamic = { 
				/*"Precipitation": layerPrecip,
				"NIRv": layerNirv*/
				};
			
			function loadTiffPrecip(filename, add) {
				dynamic_currentlayer = "precip";
				d3.request(filename).responseType('arraybuffer').get( function (error, tiffData) {
				
					// if there is a geotiff layer loaded, remove it first
					if (layerPrecip != null && layerPrecip._visible != false) {
						//layerPrecip.remove();
						layerPrecip.hide();
					}
				
					let precip = L.ScalarField.fromGeoTIFF(tiffData.response, bandIndex = 0);
					layerPrecip = L.canvasLayer.scalarField(precip, {
							color: chroma.scale(['rgba(0,0,0,0)','rgba(0,0,255,0.5)', 'rgba(0,0,255,0.6)', 'rgba(0,0,255,0.7)' , 'rgba(0,0,255,0.82)' , 'blue']).domain([0, 0.085]),		// domain: the range. can be precip.range as well, range will be automatic from data then
							opacity: 1,
							attribution: '© 2022 <a target="_blank" href="https://www.ecmwf.int">European Centre for Medium-Range Weather Forecasts (ECMWF)</a>'
							});
					precip_range = precip.range;
					//console.log(precip_range)					
					
					// what happens upon mouse hover over the raster
					layerPrecip.on("mousemove", function(e) {
						// mouse moved
						if (e.value !== null) {							// value under mouse is not null
							if (tifftooltip_precip !== null) {			// if tifftooltip is already open, close the previous tooltip so it does not get stuck on map
								map_dynamic.closeTooltip(tifftooltip_precip);
							}
							// create tooltip:
							tifftooltip_precip = L.tooltip()
								.setLatLng(e.latlng)
								.setContent(parseFloat(`${e.value*1000}`).toFixed(3) + ' mm/day'); // CONVERSION FROM M/DAY TO MM/DAY
							map_dynamic.openTooltip(tifftooltip_precip);			// open tooltip
						} else {										// value is null
							if (tifftooltip_precip !== null) {			// if any tooltip is open, close it since we went elsewhere from the area with the cursor, so previous one does not get stuck
								map_dynamic.closeTooltip(tifftooltip_precip);
							}
						}
					});
					
					if (add) {
						// add the geotiff layer to map
						layerPrecip.addTo(map_dynamic);		
					}					
					
					// if there is no layer switcher yet, create one
					if (layerControl_dynamic == null) {
						setLegend_gradient_dynamic([0, 0.085*1000], 'mm/day', chroma.scale(['rgba(0,0,0,0)','rgba(0,0,255,0.5)', 'rgba(0,0,255,0.6)', 'rgba(0,0,255,0.7)' , 'rgba(0,0,255,0.82)' , 'blue']).colors(6), map_dynamic);
						// first run, add to map so we see by default, create layer switcher
						Object.assign(overlayMaps_dynamic, { "Precipitation": layerPrecip, "NIRv": layerNirv }); 
						layerControl_dynamic = L.control.layers(overlayMaps_dynamic, {"States": dynamicmap_stateborders}, {collapsed:false}).addTo(map_dynamic);
					}
				  
				});	
					
			}
			
			function loadTiffNirv(filename, add, initial) {
				dynamic_currentlayer = "nirv";
				d3.request(filename).responseType('arraybuffer').get( function (error, tiffData) {
									
					// if there is a geotiff layer loaded, remove it first
					if (layerNirv != null && layerNirv._visible != false) {
						//layerNirv.remove();
						layerNirv.hide();
					}
					
					let nirv = L.ScalarField.fromGeoTIFF(tiffData.response, bandIndex = 0);
					layerNirv = L.canvasLayer.scalarField(nirv, {
							color: chroma.scale(['rgba(0,0,0,0)','rgba(0,100,0,0.2)', 'rgba(0,100,0,0.4)', 'rgba(0,100,0,0.6)' , 'rgba(0,100,0,0.82)' , 'darkgreen']).domain([0, 0.3755]),		// domain: the range. can be precip.range as well, range will be automatic from data then
							opacity: 1,
							attribution: ''
							});
					nirv_range = nirv.range;
					//console.log(nirv_range)	
						
					
					// what happens upon mouse hover over the raster
					layerNirv.on("mousemove", function(e) {
						if (tifftooltip_precip.isOpen()) {
							map_dynamic.closeTooltip(tifftooltip_precip);
						}
					
						// mouse moved
						if (e.value !== null) {							// value under mouse is not null
							if (tifftooltip_nirv !== null) {			// if tifftooltip is already open, close the previous tooltip so it does not get stuck on map
								map_dynamic.closeTooltip(tifftooltip_nirv);
							}
							// create tooltip:
							tifftooltip_nirv = L.tooltip()
								.setLatLng(e.latlng)
								.setContent(parseFloat(`${e.value}`).toFixed(3)); 
							map_dynamic.openTooltip(tifftooltip_nirv);			// open tooltip
						} else {										// value is null
							if (tifftooltip_nirv !== null) {			// if any tooltip is open, close it since we went elsewhere from the area with the cursor, so previous one does not get stuck
								map_dynamic.closeTooltip(tifftooltip_nirv);
							}
						}
					});
					
					if (add) {
						layerPrecip.setOpacity(0);
						
						// add the geotiff layer to map
						layerNirv.addTo(map_dynamic);		
					}						
					
					// if there is no layer switcher yet, create one
					if (layerControl_dynamic == null) {
						//setLegend_gradient_dynamic([0, 0.085], '', chroma.scale(['rgba(0,0,0,0)','rgba(0,0,255,0.5)', 'rgba(0,0,255,0.6)', 'rgba(0,0,255,0.7)' , 'rgba(0,0,255,0.82)' , 'blue']).colors(6), map_dynamic);
						// first run, add to map so we see by default, create layer switcher
						//Object.assign(overlayMaps_dynamic, { "NIRv": layerNirv }); 
						//overlayMaps_dynamic = { "NIRv": layerNirv };
						//layerControl_dynamic = L.control.layers(overlayMaps_dynamic, {"States": dynamicmap_stateborders}, {collapsed:false}).addTo(map_dynamic); 
					}
					//Object.assign(overlayMaps_dynamic, { "NIRv": layerNirv }); 
					//layerControl_dynamic = L.control.layers(overlayMaps_dynamic, {"States": dynamicmap_stateborders}, {collapsed:false}).addTo(map_dynamic); 
				  
				});		
			}
			
			// load by default
			loadTiffNirv('data/nirv_months/nirv_01.tif', false, true);
			loadTiffPrecip('data/meanmonths/precip_01.tif', true);
				
			function datumBeall(ho){
				month = ho;
				document.getElementById('month').innerHTML = swapMonthNumberwithName(parseInt(ho));
				if (dynamic_currentlayer == "precip") {
					var nextfilename = 'data/meanmonths/precip_'+String(ho).padStart(2, '0')+'.tif';
					console.log(nextfilename)
					loadTiffPrecip(nextfilename, true);
				
				} else {		
					var nextfilename = 'data/nirv_months/nirv_'+String(ho).padStart(2, '0')+'.tif';
					console.log(nextfilename)
					loadTiffNirv(nextfilename, true);		
				}
			}
			
			var idozito;
			
			function startStop(b){
				if (b.value=="Start" || b.value=="Replay") {
					// ha veget ert az animacio, megallt mert nem loopos, es az ujra gombra kattintunk, visszaallitjuk a 2000-re
					if (month >= 12) {
						month = 0;
					}
					// elinditjuk a lejatszast
					idozito=setInterval(function(){
						document.getElementById('monthslider').disabled = true;
						month+=1;
						if (month > 12) {
							// a vegere ertunk, loop ellenorzes
							if (document.getElementById('loopcheckbox').checked) {
								// loop igen, menjunk elolrol
								month = 1;
							} else {
								// loop nem, alljunk meg a vegen
								month-=1;
								clearInterval(idozito);
								document.getElementById('monthslider').disabled = false;
								// gomb: "Replay"-t irjon, mert megalltunk es a vegen vagyunk
								b.value="Replay";
							}
						}
						datumBeall(month);
						document.getElementById('monthslider').value=month;
					},500); // 500 ms per step
					b.value="Stop";
				} else {
					// megallitjuk
					document.getElementById('monthslider').disabled = false;
					clearInterval(idozito);
					b.value="Start";
				}
			}
			
			function swapMonthNumberwithName(num) {
				switch(num) {
				  case 1:
					return 'January';
				  case 2:
					return 'February';
				  case 3:
					return 'March';
				  case 4:
					return 'April';
				  case 5:
					return 'May';
				  case 6:
					return 'June';
				  case 7:
					return 'July';
				  case 8:
					return 'August';
				  case 9:
					return 'September';
				  case 10:
					return 'October';
				  case 11:
					return 'November';
				  case 12:
					return 'December';
				  default:
					return num;
				} 
			}
			/*
			map_dynamic.on('baselayerchange', function (e) {
				map_dynamic.removeControl(legend_dyn);
				if (e.name === 'Precipitation') {
					setLegend_gradient([0, 0.085], 'mm/day', chroma.scale(['black', 'orange']).colors(2), map_dynamic);
				} 
			});*/
			 
			 
			 function tooltip_slope(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>Linear fit: " + layer.feature.properties.slope_slope + "</div>";
			}
			function tooltip_r2(layer) {
				return "<div style='font-size:20px; margin-bottom: 2px'><b>" + layer.feature.properties.nome + "</b></div><div>R<sup>2</sup>: " + layer.feature.properties.correlation_r2_values_leaflet_r2 + "</div>";
			}
			 
			 // map div object,  Leaflet2 object:
			 
			var map_2 = L.map('map_2',{maxBounds: L.latLngBounds(L.latLng(-29.935789, -94.974456), L.latLng(22.153948, -27.264859)),
									maxBoundsViscosity: 1.0,
									minZoom: 3
								}); 
			map_2.addControl(new L.Control.Fullscreen());
			map_2.scrollWheelZoom.disable();
			
			// base maps
			var OSM = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; <a target="_blank" href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(map_2);
			
			// overlays			
			var x=new XMLHttpRequest();
			x.open('get', 'data/correlation_r2_slope.geojson', false);
			x.send();
			var d=JSON.parse(x.responseText);
			var mainmap_slope = L.geoJSON(d,{style: stilus_slope, onEachFeature: mousehighlight, color: 'white', weight: 2, fillOpacity: 0.7}).bindTooltip(tooltip_slope);
				mainmap_slope.getAttribution = function() { return 'TerraBrasilis: DETER dataset'; };
			var mainmap_r2 = L.geoJSON(d,{style: stilus_r2, onEachFeature: mousehighlight, color: 'white',  weight: 2, fillOpacity: 0.7}).bindTooltip(tooltip_r2);
				mainmap_r2.getAttribution = function() { return 'Instituto Brasileiro de Geografia e Estatística - IBGE'; };
			
			
			// we add the default layer to map to show when page is opened:
			mainmap_slope.addTo(map_2)
			map_2.fitBounds(mainmap_slope.getBounds());
			
			// list of overlays
			var overlayMaps_3rd = {
				
				"Slope ": mainmap_slope,
				"R<sup>2</sup>": mainmap_r2
			};
			var layerControl = L.control.layers(overlayMaps_3rd, null, {collapsed:false}).addTo(map_2);
			
			// R2/CORREL MAP: LEGEND for GRADIENTS
			function setLegend_gradient_r2correl(values, unit, colors){
				legend_r2correl = L.control({position: 'bottomright'});
				legend_r2correl.onAdd = function(map) {
				
				function colorcount(){
						var result = "";
						for (var i = 0; i<colors.length; i++) { result = result + colors[i] + ", " }
						result = result.slice(0, -2);
						return result;						
					}		
				
					var div = L.DomUtil.create("div");
					var content = '<div id="legenddiv" class="leaflet-bar custom-control legend">';
						content += '<div style="display: flex; flex-direction: column; margin-top: 4px; width: 130px;">';
							content += '<div style="background: linear-gradient(to right, '+colorcount()+') ; width: 100%; height: 14px;"></div>';
							content += '<div style="display: flex; flex-direction: row; justify-content: space-between;"><span>'+values[0]+'</span><span>'+values[1]+'</span></div><div style="display: flex; flex-direction: row; justify-content: center;">'+unit+'</div>';
						content += '</div>';
					content += '</div>';
					 
					div.innerHTML = content;
					  
					return div;
					
				};
				legend_r2correl.addTo(map_2);
			};
			
			setLegend_gradient_r2correl([-150, 5], 'km<sup>2</sup>&nbsp;per mm/day', chroma.scale(['#2166ac', '#67a9cf', '#d1e5f0', '#f7f7f7', '#fddbc7']).colors(5));
			
			map_2.on('baselayerchange', function (e) {
				map_2.removeControl(legend_r2correl);
				if (e.name === 'Slope ') {
					setLegend_gradient_r2correl([-150, 5], 'km<sup>2</sup>&nbsp;per mm/day', chroma.scale(['#2166ac', '#67a9cf', '#d1e5f0', '#f7f7f7', '#fddbc7']).colors(5));
				} else if (e.name === 'R<sup>2</sup>') {
					setLegend_gradient_r2correl([0.02, 0.905], '', chroma.scale(['#feebe2', '#fbb4b9', '#f768a1', '#c51b8a', '#7a0177']).colors(5));
				} 
			});
			
			 // DUAL AXIS CHART 1
			 
			 
			 var data = {
				"datasets": [
				  {
					"backgroundColor": "rgb(165,15,21)",
					"borderColor": "rgb(165,15,21)",
					"fill": false,
					"data": [19.624, 17.85, 29.43, 53.314, 138.498, 128.354, 244.602, 226.432, 331.004, 155.59, 37.276, 33.356],
					"label": "Deforestation",
					"yAxisID":"y1"
				  },
				  {
					"backgroundColor": "rgb(8,81,156)",
					"borderColor": "rgb(8,81,156)",
					"fill": false,
					"data": [9.862585687, 9.80565275, 10.82662277, 11.46246432, 9.35921619, 4.988833866, 2.98230954, 2.798426994, 3.997075154, 5.718009035, 8.270209801, 10.44341969],
					"label": "Precipitation",
					"yAxisID":"y2"
				  }
				],
				"labels": [
				  "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
			  };
			  
			var options = {
					plugins: {
						title: {
							display: true,
							text: "Rondônia"
					}
				},
				responsive: true,
				interaction: {
					mode: 'index',
					intersect: false
				},
				elements: {
				  "rectangle": {
					"borderWidth": 2
				  }
				},
				layout: {
				  "padding": 0
				},
				legend: {
				  "display": true,
				  "labels": {
					"boxWidth": 16
				  }
				},
				maintainAspectRatio: false,
				responsive: true,
				scales: {
					"y1": { 
							title: {
								display: true,
								text: 'Deforestation (km\u00B2)'						
							},
						position: 'left'
					},
					"y2": {
							title: {
								display: true,
								text: 'Precipitation (mm/day)'						
							},
						position: 'right',
						grid: {
						  drawOnChartArea: false, // only want the grid lines for one axis to show up
						}
					}
				},
				tooltips: {
				  "intersect": false,
				  "mode": "index",
				  "position": "nearest",
				  "callbacks": {}
				}
			};
				
			var type = "line";

			var myChart = new Chart(document.getElementById("dualaxisChart").getContext('2d'), {options: options, data: data, type: type});
			
			
			
			// DUAL AXIS CHART 2
			
			var data2 = {
				"datasets": [
				  {
					"backgroundColor": "rgb(165,15,21)",
					"borderColor": "rgb(165,15,21)",
					"fill": false,
					"data": [27.718, 4.07, 1.8, 42.48, 4.924, 13.552, 2.344, 29.688, 87.424, 37.168, 25.976, 4.184],
					"label": "Deforestation",
					"yAxisID":"y1"
				  },
				  {
					"backgroundColor": "rgb(8,81,156)",
					"borderColor": "rgb(8,81,156)",
					"fill": false,
					"data": [8.682142972, 12.62437333, 11.56642087, 8.811882839, 3.618205447, 1.155493223, 0.716872719, 0.346232603, 0.627226216, 1.625703192, 5.090730096, 6.503446867],
					"label": "Precipitation",
					"yAxisID":"y2"
				  }
				],
				"labels": [
				  "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
			  };
			  
			options.plugins.title.text = 'Tocantins';
			var myChart2 = new Chart(document.getElementById("dualaxisChart2").getContext('2d'), {options: options, data: data2, type: type});
			
			
			// DUAL AXIS CHART 3
			
			var data3 = {
				"datasets": [
				  {
					"backgroundColor": "rgb(165,15,21)",
					"borderColor": "rgb(1165,15,21)",
					"fill": false,
					"data": [482, 435, 865, 773, 932, 684, 1030, 1376, 1243, 1316, 1257, 1273, 1673],
					"label": "Deforestation",
					"yAxisID":"y1",
					"order": 2
				  },
				  {
					"backgroundColor": "rgb(8,81,156)",
					"borderColor": "rgb(8,81,156)",
					"fill": false,
					"data": [8.12, 6.92, 7.91, 7.31, 7.86, 8.11, 7.26, 7.45, 7.70, 7.09, 8.13, 7.12, 7.67],
					"label": "Precipitation",
					"type": 'line',
					"yAxisID":"y2"
				  },
				  {
					"backgroundColor": "rgb(203,201,226)",
					"borderColor": "rgb(203,201,226)",
					"fill": false,
					"data": [19.725, 23.908, 27.575, 30.113, 31.121, 34.031, 36.563, 39.461, 43.516, 44.914, 47.0913],
					"label": "GDP",
					"type": 'line',
					"yAxisID":"y3"
				  }
				],
				"labels": [
				  "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021"]
			  };
			  
			  var options2 = {
					  plugins: {
							title: {
								display: true,
								text: "Rondônia"
							}
						},
				responsive: true,
				interaction: {
					mode: 'index',
					intersect: false
				},
				elements: {
				  "rectangle": {
					"borderWidth": 2
				  }
				},
				layout: {
				  "padding": 0
				},
				legend: {
				  "display": true,
				  "labels": {
					"boxWidth": 16
				  }
				},
				maintainAspectRatio: false,
				responsive: true,
				scales: {
					"y1": {
							title: {
								display: true,
								text: 'Deforestation (km\u00B2)'						
							},
						position: 'left'
					},
					"y2": { 
							title: {
								display: true,
								text: 'Precipitation (mm/day)'						
							},
						position: 'right',
						grid: {
						  drawOnChartArea: false, // only want the grid lines for one axis to show up
						}
					},
					"y3": {
							title: {
								display: true,
								text: 'GDP (1 billion BRL)'						
							},
						position: 'right',
						grid: {
						  drawOnChartArea: false, // only want the grid lines for one axis to show up
						}
					}
				},
				tooltips: {
				  "intersect": false,
				  "mode": "index",
				  "position": "nearest",
				  "callbacks": {}
				}
			};
				
			var type = "bar";
			
			var myChart3 = new Chart(document.getElementById("dualaxisChart3").getContext('2d'), {options: options2, data: data3, type: type});
			
			// DUAL AXIS CHART 4
			
			var data4 = { 
				"datasets": [
				  {
					"backgroundColor": "rgb(165,15,21)",
					"borderColor": "rgb(1165,15,21)",
					"fill": false,
					"data": [61, 49, 40, 52, 74, 50, 57, 58, 31, 25, 23, 25, 37],
					"label": "Deforestation",
					"yAxisID":"y1",
					"order": 2
				  },
				  {
					"backgroundColor": "rgb(8,81,156)",
					"borderColor": "rgb(8,81,156)",
					"fill": false,
					"data": [6.48, 4.63, 5.74, 4.40, 5.33, 4.70, 3.84, 4.31, 5.18, 5.33, 4.68, 5.16, 5.23],
					"label": "Precipitation",
					"type": 'line',
					"yAxisID":"y2"
				  },
				  {
					"backgroundColor": "rgb(203,201,226)",
					"borderColor": "rgb(203,201,226)",
					"fill": false,
					"data": [13.689804, 16.404816, 18.345688, 20.684430, 23.796656, 26.189323, 28.930291, 31.584816, 34.108132, 35.666183, 39.355941],
					"label": "GDP",
					"type": 'line',
					"yAxisID":"y3"
				  }
				],
				"labels": [
				  "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021"]
			  };
		
			var type = "bar";
			
			options2.plugins.title.text = 'Tocantins';
			var myChart4 = new Chart(document.getElementById("dualaxisChart4").getContext('2d'), {options: options2, data: data4, type: type});
		
			// SCATTER Plot 1
			
			var ctx = document.getElementById("scatterplot").getContext('2d');

			// Define the data 
			var data5 = {
				"datasets": [
				  {       
					label: "Rondônia",
					borderColor: '#2196f3',
					backgroundColor: '#2196f3', 
					trendlineLinear: {
						lineStyle: "solid",
						width: 2
						},
					data: [{
							x: 9.8625856866,
							y: 19.624
						}, {
							x: 9.8056527496,
							y: 17.85
						},
						{
							x: 10.8266227666,
							y: 29.43
						},
						{
							x: 11.46246432,
							y: 53.314
						},
						{
							x: 9.3592161904,
							y: 138.498
						},
						{
							x: 4.988833866,
							y: 128.354
						},
						{
							x: 2.9823095396,
							y: 244.602
						},
						{
							x: 2.7984269938,
							y: 226.432
						},
						{
							x: 3.9970751536,
							y: 331.004
						},
						{
							x: 5.7180090346,
							y: 155.59
						},
						{
							x: 8.2702098008,
							y: 37.276
						},
						{
							x: 10.4434196884,
							y: 33.356
						}
					 ]
				},
				{
					label: "Tocantins",
					borderColor: '#f49968',
					backgroundColor: '#f49968',
					trendlineLinear: {
						lineStyle: "solid",
						width: 2
						},
					data: [{
							x: 8.68214297199991,
							y: 27.718
						}, {
							x: 12.6243733272332,
							y: 4.07
						},
						{
							x: 11.5664208675017,
							y: 1.8
						},
						{
							x: 8.81188283859937,
							y: 42.48
						},
						{
							x: 3.61820544731617,
							y: 4.924
						},
						{
							x: 1.15549322276073,
							y: 13.552
						},
						{
							x: 0.716872719471636,
							y: 2.344
						},
						{
							x: 0.346232602552039,
							y: 29.688
						},
						{
							x: 0.627226215892753,
							y: 87.424
						},
						{
							x: 1.6257031918881,
							y: 37.168
						},
						{
							x: 5.09073009614505,
							y: 25.976
						},
						{
							x: 6.50344686698301,
							y: 4.184
						}
					 ]
				}]
			};
					 
			// End Defining data
			var options_scatter = {responsive: true, // Instruct chart js to respond nicely.
				maintainAspectRatio: false,
				scales: {
					y: {
					  title: {
						display: true,
						text: 'Deforestation (km\u00B2)'
					  }
					},
					x: {
					  title: {
						display: true,
						text: 'Precipitation (mm/day)'
					  }
					}
				},
				interaction: {
						mode: 'index',
						intersect: false
					}				// Add to prevent default behaviour of full-width/height 
			};

			// End Defining data
			var myChart5 = new Chart(ctx, {
				type: 'scatter',
				data: data5,
				options: options_scatter
			});			
			
			function downloadimage() {
				var a = document.createElement('a');
				a.href = myChart5.toBase64Image();
				a.download = "myChart5.png";
				a.click();			
			}
		</script>
	</body>
</html>
