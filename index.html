<!doctype html>

<html>
	<head>
		<title>Deforestation</title>
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans">
		<link rel="stylesheet" href="leaflet/leaflet.css" />
		<script src="leaflet/leaflet.js"></script>
		<link rel="stylesheet" href="leaflet/leaflet.fullscreen.css" />
		<script src="leaflet/leaflet.fullscreen.js"></script>
		<script src="leaflet/leaflet.fullscreen.js"></script>
		<script src="highcharts/highcharts.js"></script>
		<script src="highcharts/sankey.js"></script>
		<script src="highcharts/dependency-wheel.js"></script>
		<script src="highcharts/exporting.js"></script>
		<script src="highcharts/export-data.js"></script>
		<script src="highcharts/accessibility.js"></script>
		<style>
			html, body {
				height: 100%;
				margin: 0;
				font-family: 'Open Sans', 'OpenSans-Local';
				font-style: normal;
				color: #373f27;
				background-color: #e9e7da;
				
			}
			p {
				text-align: justify;
			}
			
			#map {
				width: 65%;
				height: 400px;
				margin:  auto;
			}
			.section {
				padding-left: 250px;
				padding-right: 250px;
				padding-top: 5px;
				padding-bottom: 5px;
			}
			.imagesection {
			}
			.datawrapper_element {
			  background-color: white;
			  padding-top: 10px;
			  padding-bottom: 10px;
			  padding-left: 30px;
			  padding-right: 30px;
			}
			.cim_a_kepen {
				color: white; 
				font-weight: bold; 
				font-size: 15pt;
				text-shadow: 2px 2px 5px #000000c7;
			}
			/* Scroll reveal animation: https://alvarotrigo.com/blog/css-animations-scroll/ */
			.reveal {
			  position: relative;
			  transform: translateY(150px);
			  opacity: 0;
			  transition: 2s all ease;
			}
			.reveal.active{
			  transform: translateY(0);
			  opacity: 1;
			}
			#topbar {
				background-color: white;
				width: 100%;
				top: 0;
				height: 150px;
				padding-top: 24px;
				padding-bottom: 24px;
				padding-left: 38px;
				padding-right: 38px;
				display: flex;
				box-sizing: border-box;
			}
			
			/* Highcharts */
			.highcharts-data-table table {
				font-family: Verdana, sans-serif;
				border-collapse: collapse;
				border: 1px solid #ebebeb;
				margin: 10px auto;
				text-align: center;
				width: 100%;
				max-width: 500px;
			}

			.highcharts-data-table caption {
				padding: 1em 0;
				font-size: 1.2em;
				color: #555;
			}

			.highcharts-data-table th {
				font-weight: 600;
				padding: 0.5em;
			}

			.highcharts-data-table td,
			.highcharts-data-table th,
			.highcharts-data-table caption {
				padding: 0.5em;
			}

			.highcharts-data-table thead tr,
			.highcharts-data-table tr:nth-child(even) {
				background: #f8f8f8;
			}

			.highcharts-data-table tr:hover {
				background: #f1f7ff;
			}

			#csv {
				display: none;
			}
		</style>
	</head>
	<body>
		
		<div id="topbar">
			<div style="display: flex; flex-direction: row; justify-content: space-between; align-items: center; width: 100%">
				<img src="stop.jpg" style="height: 130px"></img>
				<h1 style="font-size:20px;">Rapidly increasing deforestation of the Amazon rainforest</h1>
				<div style="display: flex; flex-direction: row; column-gap: 20px;">
					<a href="#section1">Deforestation by states</a>
					<a href="https://www.w3schools.com">Visit W3Schools</a>
					<a href="https://www.w3schools.com">Visit W3Schools</a>
				</div>
			</div>
		</div>
			
		<div id="maincontent" style="display: flex; flex-direction: column; row-gap: 20px;">			
			
			<div id="imagesection1" class="imagesection reveal">
				<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);" class="cim_a_kepen">The Amazon is the largest tropical forest and offers many important ecosystem services, including the sequestration of substantial amounts of carbon, recycling of moisture and supporting biodiversity. Deforestation is one of the major threats that the Amazon is currently facing(Fig 1). Since the early 2000s the rate of deforestation in the Amazon has steadily reduced, but is rising again since ~2018 (Fig 2). Earlier research has shown that deforestation can have a short positive effect on local communities (as expressed by the Human Development Index), but that this effect does not last for long.</div>
				<img src="forest.jpg" style="max-width: 100%"></img>
			</div>
			
			<div id="section0" class="section reveal">
				<h2>States Map</h2>
				<p>The Amazon is the largest tropical forest and offers many important ecosystem services, including the sequestration of substantial amounts of carbon, recycling of moisture and supporting biodiversity. Deforestation is one of the major threats that the Amazon is currently facing(Fig 1). Since the early 2000s the rate of deforestation in the Amazon has steadily reduced, but is rising again since ~2018 (Fig 2). Earlier research has shown that deforestation can have a short positive effect on local communities (as expressed by the Human Development Index), but that this effect does not last for long. </p>
				<div id="map">
				</div>
			</div>
			
			<div id="section1" class="section reveal">
				<figure class="highcharts-figure">
					<div id="container"></div>
						<p class="highcharts-description">
							Chart showing a dependency wheel, where each point consists of multiple
							weighted links to other points. This chart type is often used to
							visualize data flow, and can be a striking way to illustrate
							elationships in data.
						</p>
				</figure>
				<h2>Deforestation by states (Legal Amazon)</h2>
				<p>The Amazon is the largest tropical forest and offers many important ecosystem services, including the sequestration of substantial amounts of carbon, recycling of moisture and supporting biodiversity. Deforestation is one of the major threats that the Amazon is currently facing(Fig 1). Since the early 2000s the rate of deforestation in the Amazon has steadily reduced, but is rising again since ~2018 (Fig 2). Earlier research has shown that deforestation can have a short positive effect on local communities (as expressed by the Human Development Index), but that this effect does not last for long.  </p>
				<div id="diagram" class="datawrapper_element">
					<iframe title="Deforestation increments by states - Legal Amazon 
					" aria-label="Interactive line chart" id="datawrapper-chart-Hj5aG" src="https://datawrapper.dwcdn.net/Hj5aG/2/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="518"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();</script>
				</div>
			</div>
			
			<div id="imagesection2" class="imagesection reveal">
				<img src="fire.jpg" style="max-width: 100%"></img>
			</div>
			
			<div id="section2" class="section reveal">
				<h2>What is NIRv?</h2>
				<iframe frameborder="0" class="juxtapose" width="600" height="360" src="https://cdn.knightlab.com/libs/juxtapose/latest/embed/index.html?uid=5d1f9d30-551c-11ed-b5bd-6595d9b17862"></iframe>
				<p>The Amazon is the largest tropical forest and offers many important ecosystem services, including the sequestration of substantial amounts of carbon, recycling of moisture and supporting biodiversity. Deforestation is one of the major threats that the Amazon is currently facing(Fig 1). Since the early 2000s the rate of deforestation in the Amazon has steadily reduced, but is rising again since ~2018 (Fig 2). Earlier research has shown that deforestation can have a short positive effect on local communities (as expressed by the Human Development Index), but that this effect does not last for long.</p>
				<div id="areamap" class="datawrapper_element">
					<iframe title="[ area ]" aria-label="Map" id="datawrapper-chart-fkXGc" src="https://datawrapper.dwcdn.net/fkXGc/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="576"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();</script>
				</div>
			</div>
			
			<div id="section3" class="section reveal">
				<h2>NIRv over the years</h2>
				<p>The Amazon is the largest tropical forest and offers many important ecosystem services, including the sequestration of substantial amounts of carbon, recycling of moisture and supporting biodiversity. Deforestation is one of the major threats that the Amazon is currently facing(Fig 1). Since the early 2000s the rate of deforestation in the Amazon has steadily reduced, but is rising again since ~2018 (Fig 2). Earlier research has shown that deforestation can have a short positive effect on local communities (as expressed by the Human Development Index), but that this effect does not last for long.</p>
				<div id="diagram2" class="datawrapper_element">
					<iframe title="Annual NIRV " aria-label="Interactive line chart" id="datawrapper-chart-bjA3y" src="https://datawrapper.dwcdn.net/bjA3y/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="420"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();</script>
				</div>
			</div>

			<div id="section4" class="section reveal">
				<div id="diagram3" class="datawrapper_element">
					<iframe title="ciiiiiiime a cucclinaaak" aria-label="Map" id="datawrapper-chart-xCBhx" src="https://datawrapper.dwcdn.net/xCBhx/1/" scrolling="no" frameborder="0" style="width: 0; min-width: 100% !important; border: none;" height="703"></iframe><script type="text/javascript">!function(){"use strict";window.addEventListener("message",(function(e){if(void 0!==e.data["datawrapper-height"]){var t=document.querySelectorAll("iframe");for(var a in e.data["datawrapper-height"])for(var r=0;r<t.length;r++){if(t[r].contentWindow===e.source)t[r].style.height=e.data["datawrapper-height"][a]+"px"}}}))}();</script>
				</div>
			</div>
		</div>
		
		<script>
			// Scroll reveal animation: https://alvarotrigo.com/blog/css-animations-scroll/
			function reveal() {
			  var reveals = document.querySelectorAll(".reveal");
			  for (var i = 0; i < reveals.length; i++) {
				var windowHeight = window.innerHeight;
				var elementTop = reveals[i].getBoundingClientRect().top;
				var elementVisible = 150;
				if (elementTop < windowHeight - elementVisible) {
				  reveals[i].classList.add("active");
				} else {
				  reveals[i].classList.remove("active");
				}
			  }
			}
			
			window.addEventListener("scroll", reveal);

			// To check the scroll position on page load
			reveal();
			
			function areatokm2(value) {
				result = value/1000000
				return result
			}
			
			function tooltip_area(layer) {
				return "<b><div style='font-size:20px'>" + layer.feature.properties.nome + "</div></b><br> area: " + areatokm2(layer.feature.properties.area).toFixed(2) + " km<sup>2</sup>";
			}
			function tooltip_deforestation(layer) {
				return "<b><div style='font-size:20px'>" + layer.feature.properties.nome + "</div></b><br> deforestation: " + layer.feature.properties.deforestation_average_Average.toFixed(2) + " %";
			}
			function tooltip_nirv(layer) {
				return "<b><div style='font-size:20px'>" + layer.feature.properties.nome + "</div></b><br> NIRv: " + layer.feature.properties.nirv_average_Average.toFixed(3);
			}
			function tooltip_population(layer) {
				return "<b><div style='font-size:20px'>" + layer.feature.properties.nome + "</div></b><br> population: " + layer.feature.properties.population_average_average.toLocaleString();
			}
			function tooltip_gdp(layer) {
				return "<b><div style='font-size:20px'>" + layer.feature.properties.nome + "</div></b><br> GDP (R$ 1000): " + layer.feature.properties.gdp_average_Average;
			}
			
			function stilus_area(feature){
				var p = feature.properties;
				
				if (p.area > 27719162110) {
					return {
						color: '#05014a'
					}
				} else if (p.area > 23739064061) {
					return {
						color: '#020079'
					};
				} else if (p.area > 16391085419) {
					return {
						color: '#0006b1'
					};
				} else if (p.area > 12449191588) {
					return {
						color: '#0013de'
					};
				} else {
					return {
						color: '#0021f3'
					};
				}
			}
			
			function stilus_deforestation(feature){
				var p = feature.properties;
				
				if (p.deforestation_average_Average > 8.0892) {
					return {
						color: '#000000'
					}
				} else if (p.deforestation_average_Average > 3.6333){
					return {
						color: '#400000'
					};
				} else if (p.deforestation_average_Average > 1.2308){
					return {
						color: '#800000'
					};
				} else if (p.deforestation_average_Average > 0.4993){
					return {
						color: '#bf0000'
					};
				} else {
					return {
						color: '#ff0000'
					};
				}
			} 
			
			function stilus_nirv(feature){
				var p = feature.properties;
				
				if (p.nirv_average_Average > 0.24327) {
					return {
						color: '#000c00'
					}
				} else if (p.nirv_average_Average > 0.22448){
					return {
						color: '#004000'
					};
				} else if (p.nirv_average_Average > 0.20270){
					return {
						color: '#008000'
					};
				} else if (p.nirv_average_Average > 0.15989){
					return {
						color: '#7fbf7f'
					};
				} else {
					return {
						color: '#e5f2e5'
					};
				}
			}
			
			function stilus_population(feature){
				var p = feature.properties;
				
				if (p.population_average_average > 6468043) {
					return {
						color: '#4c4c00'
					}
				} else if (p.population_average_average > 3067893){
					return {
						color: '#7f7f00'
					};
				} else if (p.population_average_average > 742535){
					return {
						color: '#b2b200'
					};
				} else if (p.population_average_average > 483370){
					return {
						color: '#e5e500'
					};
				} else {
					return {
						color: '#ffff00'
					};
				}
			}
			
			function stilus_gdp(feature){
				var p = feature.properties;
				
				if (p.gdp_average_Average > 98751895.61) {
					return {
						color: '#111111'
					}
				} else if (p.gdp_average_Average > 72120267.52){
					return {
						color: '#333333'
					};
				} else if (p.gdp_average_Average > 26250552.77){
					return {
						color: '#555555'
					};
				} else if (p.gdp_average_Average > 9736747.77){
					return {
						color: '#777777'
					};
				} else {
					return {
						color: '#999999'
					};
				}
			}
			
			
			function mousehighlight (feature, layer) {
					// when hover over the feature, highlight it
					layer.on('mouseover', function () {
						this.setStyle({
							'weight': '5',
							'fillOpacity': '0.6'
						});
					});
					// when we go off the feature, return to default style
					layer.on('mouseout', function () {
						this.setStyle({
							'fillColor': feature.properties.fillColor,
							'weight': '4',
							'fillOpacity': '0.2'
						});
					});
				}
				
				
			// map div object, main Leaflet object:
			var map = L.map('map',{maxBounds: L.latLngBounds(L.latLng(-29.935789, -94.974456), L.latLng(22.153948, -27.264859)),
								maxBoundsViscosity: 1.0
									}).setView([-6.641224624683114,-55.6095886343115], 4); 
			map.addControl(new L.Control.Fullscreen());
			map.scrollWheelZoom.disable();
			
			// base maps
			var OSM = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
			}).addTo(map);
			
			// overlays			
			var x=new XMLHttpRequest();
			x.open('get', 'data/main_map.geojson', false);
			x.send();
			var d=JSON.parse(x.responseText);
			var mainmap_area = L.geoJSON(d,{style: stilus_area, onEachFeature: mousehighlight}).bindTooltip(tooltip_area);
				mainmap_area.getAttribution = function() { return 'TerraBrasilis: DETER dataset'; };
			var mainmap_deforestation = L.geoJSON(d,{style: stilus_deforestation, onEachFeature: mousehighlight}).bindTooltip(tooltip_deforestation);
				mainmap_deforestation.getAttribution = function() { return 'TerraBrasilis: DETER dataset'; };
			var mainmap_nirv = L.geoJSON(d,{style: stilus_nirv, onEachFeature: mousehighlight}).bindTooltip(tooltip_nirv);
				mainmap_nirv.getAttribution = function() { return 'By Gerbrand'; };
			var mainmap_population = L.geoJSON(d,{style: stilus_population, onEachFeature: mousehighlight}).bindTooltip(tooltip_population);
				mainmap_population.getAttribution = function() { return 'Instituto Brasileiro de Geografia e Estatística - IBGE'; };
			var mainmap_gdp = L.geoJSON(d,{style: stilus_gdp, onEachFeature: mousehighlight}).bindTooltip(tooltip_gdp);
				mainmap_gdp.getAttribution = function() { return 'Instituto Brasileiro de Geografia e Estatística - IBGE'; };
			
			// we add the default layer to map to show when page is opened:
				mainmap_area.addTo(map)
			
			// list of overlays
			var overlayMaps = {
				"Research area ": mainmap_area,
				"Deforestation % ": mainmap_deforestation,
				"NirV ": mainmap_nirv,
				"Population ": mainmap_population,
				"GDP ": mainmap_gdp
			};
			// layer switcher enable
			var layerControl = L.control.layers(overlayMaps, null, {collapsed:false}).addTo(map);
			
			
			// HIGHCHARTS - DEPENDENCY WHEEL:
			Highcharts.chart('container', {

				title: {
					text: 'Correlation among social and natural factors'
				},
				
				subtitle: {
					text: 'Subtitle is something'
				},

				// tooltip lower row format
				tooltip: {
					//pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
					//pointFormat: '{index}. From {point.from} to {point.to}: {point.weight} {point.mas}'
					pointFormat: 'Correlation between {point.from} and {point.to}: {point.source}'
				},
				
				accessibility: {
					point: {
						valueDescriptionFormat: 'Correlation between {point.from} and {point.to}: {point.source}.'
					}
				},

				series: [{
					type: 'dependencywheel',
					name: 'Dependency wheel series', 				// appears on top of tooltip, indicating the series name
					cursor: 'pointer',								// make cursor a pointer cursor when hovering over the chart
					keys: ['from', 'to', 'weight', 'source'],
					data: [
						['valami', 'masvalami', 0.5, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['mittudomenmi', 'masvalami', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['wildfires', 'mittudomenmi', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['wildfires', 'hogy allnak epp a csillagok', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['wildfires', 'valami', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['logging', 'hogy allnak epp a csillagok', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['logging', 'valami', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['logging', 'masvalami', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['hogy allnak epp a csillagok', 'valami', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['valami', 'logging', 1, 'https://www.researchgate.net/publication/347306942_Quality_assessment_of_the_PRODES_Cerrado_deforestation_data'],
						['valami', 'hogy allnak epp a csillagok', 1]
					],
					dataLabels: {
						color: '#333',
						style: {
							textOutline: 'none'
						},
						textPath: {
							enabled: true
						},
						distance: 10
					},
					size: '95%',
					events: {
						click: function (event) {
							// on click of a relation, open the reference URL (paper, literature) from field "source", if it exists:
							if (event.point.source != null) {
								window.open(event.point.source, "_blank");hááááhhh
							}
						}
					}
				}]

			});
			
		</script>
	</body>
</html>